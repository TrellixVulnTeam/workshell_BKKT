var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function s(t){try{l(n.next(t))}catch(e){r(e)}}function a(t){try{l(n["throw"](t))}catch(e){r(e)}}function l(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(s,a)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(n){i=[6,n],r=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,r,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return{next:i(0),"throw":i(1),"return":i(2)}},BasePanel=function(t){function e(e,i){void 0===i&&(i=!1);var n=t.call(this)||this;return n.panelData=e,n.addEventListener(eui.UIEvent.COMPLETE,n.uiCompHandler,n),n.skinName="basePanelSkin",i&&(n.buttonOK.visible=!1,n.buttonOK0.visible=!1,n.buttonCancel.visible=!1,n.buttonCancel0.visible=!1),n}return __extends(e,t),e.prototype.uiCompHandler=function(){this.buttonOK.label=this.panelData.okStr?this.panelData.okStr:"确定",this.buttonCancel.label=this.panelData.cancelStr?this.panelData.cancelStr:"取消",this.buttonOK0.label=this.panelData.okStr?this.panelData.okStr:"确定",this.buttonCancel0.label=this.panelData.cancelStr?this.panelData.cancelStr:"取消",this.panelData.content&&(this.contentLabel.text=this.panelData.content),this.buttonOK.addEventListener(egret.TouchEvent.TOUCH_TAP,this.okFunc,this),this.buttonCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelFunc,this),this.buttonOK0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.okFuncC,this),this.buttonCancel0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelFuncC,this),this.panelData.okFuncC&&(this.buttonOK0.visible=!0,this.buttonCancel0.visible=!0)},e.prototype.closeFunc=function(){SoundManager.playEffect("tap"),this.parent&&this.parent.removeChild(this),console.log("closeFunc")},e.prototype.okFunc=function(){this.panelData.okFunc&&"function"==typeof this.panelData.okFunc&&this.panelData.okFunc(),this.closeFunc()},e.prototype.cancelFunc=function(){this.panelData.cancelFunc&&"function"==typeof this.panelData.cancelFunc&&this.panelData.cancelFunc(),this.closeFunc()},e.prototype.okFuncC=function(){console.log(123),this.panelData.okFuncC&&"function"==typeof this.panelData.okFuncC&&this.panelData.okFuncC(),this.buttonOK.visible=!1,this.buttonOK0.visible=!1,this.buttonCancel.visible=!1,this.buttonCancel0.visible=!1},e.prototype.cancelFuncC=function(){console.log(123),this.panelData.cancelFuncC&&"function"==typeof this.panelData.cancelFuncC&&this.panelData.cancelFuncC(),this.buttonOK.visible=!1,this.buttonOK0.visible=!1,this.buttonCancel.visible=!1,this.buttonCancel0.visible=!1},e}(eui.Panel);__reflect(BasePanel.prototype,"BasePanel");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?n(o):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var SoundManager=function(){function t(){}return t.playEffect=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=1),this.channelEFF&&(this.channelEFF.stop(),this.channelEFF=null);try{this.sound_eff=RES.getRes(t),this.sound_eff.type=egret.Sound.EFFECT;var n=this.sound_eff.play(0,1);n.volume=i}catch(o){return}},t.playBgSound=function(t,e,i){if(void 0===e&&(e=1),void 0===i&&(i=!0),this.enableSound){this.channelBG&&(this.channelBG.stop(),this.channelBG=null);try{this.sound_bg=RES.getRes(t),this.sound_bg.type=egret.Sound.MUSIC,"bg_hall"==t?(this.channelBG=this.sound_bg.play(0,0),this.channelBG.volume=1):"bg_room"==t&&(this.channelBG=this.sound_bg.play(0,0),this.channelBG.volume=.5)}catch(n){return}}},t.stopSound=function(){this.channelBG&&(this.channelBG.stop(),this.channelBG=null),this.channelEFF&&(this.channelEFF.stop(),this.channelEFF=null)},t}();__reflect(SoundManager.prototype,"SoundManager");var Utils=function(){function t(){}return t.paramToStr=function(t){var e=JSON.stringify(t);e=e.replace(/[\{\}]/g,"");for(var i=e.split(","),n=i.length,o="",r=0;n>r;r++){var s=i[r].split(":");0!==r&&(o+="&"),o+=s[0].replace(/[\"]/g,""),o+="=",o+=s[1].replace(/[\"]/g,"")}return o},t.pointToYuan=function(t){var e=t,i=e/100;return i.toString()},t.parseQuery=function(t){var e={},i=function(t){return decodeURIComponent(t.replace(/\+/g," "))};t=t||window.location.search;var n=t.split("?")[1];if(!t||!n)return e;for(var o=n.split("&"),r=o.length,s=0;r>s;s++){var a=o[s].split("="),l=a[0],h=i(a[1]||""),c=e[l];c?Array.isArray(c)?c.push(h):e[l]=[c,h]:e[l]=h}return e},t.getCurDate=function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,n=t.getDate();return e+"/"+this.numAddZero(i)+"/"+this.numAddZero(n)},t.getCurTime=function(t){void 0===t&&(t="");var e=new Date,i=e.getHours(),n=e.getMinutes(),o=e.getSeconds()+1;switch(t){case"second":return this.numAddZero(i)+":"+this.numAddZero(n)+":"+this.numAddZero(o);default:case"minute":return this.numAddZero(i)+":"+this.numAddZero(n)}},t.numAddZero=function(t){return t>=10?t+"":t>=0&&10>t?"0"+t:t+""},t.getGameUrl=function(){return window.location.protocol+"//"+window.location.hostname+":"+window.location.port+window.location.pathname},t.formatScoreForRead=function(t){var e=parseFloat(t),i=String(e),n=!1;return 0>e&&(n=!0,e=-e),i=e>=1e4&&1e8>e?(e/1e4).toFixed(2)+"万":e>=1e8?(e/1e8).toFixed(2)+"亿":String(e),n&&(i="-"+i),i},t.rand=function(t,e){var i=e-t,n=Math.random(),o=t+Math.round(n*i);return o},t.num2bull=function(t){var e=["无牛","牛丁","牛二","牛三","牛四","牛五","牛六","牛七","牛八","牛九","牛牛","五花牛","","","五小牛"];return e[t]},t.deviceInfo=function(){},t.timeToDate=function(t){return new Date(1e3*parseInt(t)).toLocaleString().replace(/年|月/g,"-").replace(/日/g," ")},t.formatting=function(e){var i,n;return{banker:parseInt(e.banker)?!0:!1,nickname:e.nickname,isSelf:e.uid==Config.USER_OPEN_ID,bet:function(){return e.bet&&"×"!=e.bet.toString()[0]?"×"+e.bet:void 0}(),result:function(){return i=t.num2bull(e.result)}(),resultColor:function(){var t="牛牛"==i||"五花牛"==i||"五小牛"==i?2949070:16756268;return"无牛"==i&&(t=12566463),t}(),p:e.p,score:function(){return n=parseInt(e.score)>0&&"+"!=e.score.toString()[0]?"+"+e.score:String(e.score)}(),scoreColor:function(){return"-"==n[0]?6519295:16756268}(),time:t.timeToDate(e.time)}},t}();__reflect(Utils.prototype,"Utils");var GEvent=function(t){function e(e,i,n,o){void 0===i&&(i=null),void 0===n&&(n=!1),void 0===o&&(o=!1);var r=t.call(this,e,n,o)||this;return i&&(r._dataType=i.t,r._data=i),r}return __extends(e,t),Object.defineProperty(e.prototype,"t",{get:function(){return this._dataType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"d",{get:function(){return this._data},enumerable:!0,configurable:!0}),e}(egret.Event);GEvent.RECEIVE="receive",GEvent.SEND="send",GEvent.ROOM="room",GEvent.PLAYER_SIT_DOWN="player_sit_down",GEvent.HALL_HELP="hallHelp",GEvent.CREATE_ROOM="createRoom",GEvent.JOIN_ROOM="joinRoom",GEvent.JOIN_ROOM_QUICK="joinRoomQuick",GEvent.ZHANJI="zhanji",GEvent.ROOM_RECORD="roomRecord",GEvent.GAME_OVER_SUCCESS="gameOver",__reflect(GEvent.prototype,"GEvent");var SMEvent=function(t){function e(e,i,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1);var r=t.call(this,e,n,o)||this;return i&&(r._data=i,r._dataType=i.t),r}return __extends(e,t),Object.defineProperty(e.prototype,"t",{get:function(){return this._dataType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"d",{get:function(){return this._data},enumerable:!0,configurable:!0}),e}(egret.Event);SMEvent.GAMEMESSAGE="gameMessage",SMEvent.CONNECTCOMPLETE="connectComplete",SMEvent.RESTARTCONNECT="restartConnect",__reflect(SMEvent.prototype,"SMEvent");var LoadingText=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.x=0,this.textField.y=500,this.textField.width=1920,this.textField.height=100,this.textField.size=40,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){var i=".";i=t/e%2==0?"...":".....",this.textField.text="正在努力加载中."+i},e}(egret.Sprite);__reflect(LoadingText.prototype,"LoadingText");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="LoadingSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this)},e.prototype.uiCompHandler=function(){this.buttonWX.visible=!1,this.buttonWX.enabled=!1},e.prototype.setProgress=function(t,e){this.bar.maximum=e,this.bar.value=t,this.percent.text=(t/e*100).toFixed(0)+"%",t==e&&(this.percent.visible=!1)},e.prototype.showLoadingDone=function(){this.label.text="加载完成",this.bar.visible=!1,this.percent.visible=!1,this.buttonWX.visible=!0,this.buttonWX.enabled=!0,this.bindEvent()},e.prototype.hideLoading=function(){this.label.visible=!1,this.bar.visible=!1,this.bar.enabled=!1},e.prototype.bindEvent=function(){this.buttonWX.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"test"==Config.ENV||(window.location.href=Config.LOGIN_URL)},this)},e}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.Capabilities.isMobile?this.stage.scaleMode=egret.StageScaleMode.EXACT_FIT:this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL;var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){this.stage.orientation=egret.OrientationMode.LANDSCAPE,RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},e.prototype.onThemeLoadComplete=function(){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loading"),this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"loading"==t.groupName?(window.document.getElementById("txt").style.display="none",this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),this.isResourceLoadEnd=!0,RES.loadGroup("preload")):"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){if("loading"==t.groupName){var e=".";e=t.itemsLoaded/t.itemsTotal%2==0?"...":".....",window.document.getElementById("txt").textContent="正在努力加载中."+e}"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.startCreateScene=function(){e.Stage=egret.MainContext.instance.stage,e.Stage.maxTouches=1,SoundManager.enableSound=!0,SoundManager.enableEffect=!0;var t=egret.localStorage.getItem("ticket"),i=(egret.localStorage.getItem("bull_userOpenId"),location.href),n=new URL(i),o=n.searchParams.get("ticket");this.loadingView&&this.loadingView.hideLoading(),t||o?(GameController.getInstance().addEventListener(GEvent.RECEIVE,this.recevieMessage,this),Config.USER_TICKET=o||t,egret.localStorage.setItem("ticket",Config.USER_TICKET),this.stage.removeChild(this.loadingView),this.loadingView=null,this.addChild(HallLayer.getInstance()),this.addChild(PageLayer.getInstance())):this.loadingView&&this.loadingView.showLoadingDone()},e.prototype.recevieMessage=function(t){var i=t.t,n=t.d,o=n.d;switch(i){case CMD.SERVER_COMMAND_ENTER:HallLayer.getInstance().updata(n),"r"in o&&e.Stage.dispatchEvent(new GEvent(GEvent.ROOM,n))}},e}(eui.UILayer);__reflect(Main.prototype,"Main");var CMD=function(){function t(){}return t}();CMD.SERVER_COMMAND_BET="bet",CMD.SERVER_COMMAND_EXIT="exitRoom",CMD.SERVER_COMMAND_JOIN="join",CMD.SERVER_COMMAND_CHAT="chat",CMD.SERVER_COMMAND_KICK="kick",CMD.SERVER_COMMAND_ERROR="error",CMD.SERVER_COMMAND_READY="ready",CMD.SERVER_COMMAND_HEART="heart",CMD.SERVER_COMMAND_ENTER="enter",CMD.SERVER_COMMAND_ROOM="room",CMD.SERVER_COMMAND_START="start",CMD.SERVER_COMMAND_BANKER="banker",CMD.SERVER_COMMAND_RESULT="result",CMD.SERVER_COMMAND_FINISH="finish",CMD.SERVER_COMMAND_ONLINE="online",CMD.SERVER_COMMAND_HISTORY="history",CMD.SERVER_COMMAND_HISTORY_DES="desc",CMD.SERVER_COMMAND_DISSOLVEROOM="dissolveRoom",CMD.SERVER_COMMAND_VOTE="vote",CMD.SERVER_COMMAND_VR="vr",CMD.SERVER_COMMAND_cVOTE="cVote",CMD.CLIENT_COMMAND_BET="bet",CMD.CLIENT_COMMAND_CHAT="chat",CMD.CLIENT_COMMAND_JOIN="join",CMD.CLIENT_COMMAND_READY="ready",CMD.CLIENT_COMMAND_HEART="heart",CMD.CLIENT_COMMAND_LOGIN="login",CMD.CLIENT_COMMAND_CREATE="create",CMD.CLIENT_COMMAND_BANKER="banker",CMD.CLIENT_COMMAND_EXIT="exitRoom",CMD.CLIENT_COMMAND_DISSOLVEROOM="dissolveRoom",CMD.CLIENT_COMMAND_QUICK="quick",__reflect(CMD.prototype,"CMD");var Config=function(){function t(){}return t}();Config.ENV="production",Config.LOGIN_URL="http://api.pkgame.net/account/gameLogin?invoker=nn",Config.YXDT_URL="m.pkgame.net/",Config.SOCKET_URL="jdnn.pkgame.net",Config.SOCKET_PORT=8500,Config.AVATAR_URL_TEST="http://avatar-yxdt.pkgame.net",Config.AVATAR_URL="http://avatar-yxdt.pkgame.net/",Config.USER_OPEN_ID="",Config.USER_TICKET="",Config.ROOM_START_GAME=!1,Config.TIMER_PLAYER_OUT=null,Config.TIMEOUT_PREPARE=15,Config.TIMEOUT_BANKER=15,Config.TIMEOUT_TIMES=15,Config.TIMEOUT_BULL=15,Config.TIMEOUT_RECORD=15,__reflect(Config.prototype,"Config");var Http=function(){function t(){this.req=new egret.HttpRequest}return t.create=function(){return new t},t.prototype["default"]=function(){return this.header("Accept","application/json;charset=UTF-8"),this.header("Content-Type","application/json;charset=UTF-8"),this},t.prototype.dataFormat=function(t){return this.req.responseType=t,this},t.prototype.header=function(t,e){return this.req.setRequestHeader(t,e),this},t.prototype.get=function(t,e){return this.req.open(t+e,egret.HttpMethod.GET),this["default"](),this.req.send(),this.req.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this),this},t.prototype.post=function(t,e,i){if(this.req.open(t,egret.HttpMethod.POST),this["default"](),i)for(var n=0,o=i.length;o>n;++n)this.req.setRequestHeader(i[n].header,i[n].value);return this.req.send(e),this.req.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),this},t.prototype.succ=function(t,e){this.req.addEventListener(egret.Event.COMPLETE,t,e)},t.prototype.onGetIOError=function(t){console.log("get error : "+t)},t.prototype.onPostIOError=function(t){console.log("post error : "+t)},t}();__reflect(Http.prototype,"Http");var JsonpReq=function(){function t(){}return t.process=function(e){t.completeCall["call_"+t._regID]=function(i){var n=t._regID;e.data=i,e.dispatchEvent(new egret.Event(egret.Event.COMPLETE)),delete t.completeCall["call_"+n]},t.startLoader(e,t._regID++)},t.startLoader=function(t,e){var i=document.createElement("script");i.src=t._request.url+"&callback=JsonpReq.completeCall.call_"+e,document.body.appendChild(i)},t}();JsonpReq._regID=0,JsonpReq.completeCall={},__reflect(JsonpReq.prototype,"JsonpReq");var SocketManager=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.socket=new egret.WebSocket,e.restartKey=null,e}return __extends(e,t),e.prototype.connectServer=function(t,e){void 0===t&&(t=""),void 0===e&&(e=80),null!=this.socket&&this.socket.close(),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_STRING,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),egret.log("socket:  "+t+":"+e),this.socket.connect(t,e)},e.prototype.onSocketClose=function(){egret.log("WebSocketClose"),this.restart()},e.prototype.onSocketError=function(){egret.log("WebSocketError"),this.restartError()},e.prototype.onSocketOpen=function(){egret.log("WebSocketOpen"),egret.clearInterval(this.restartKey),this.restartKey=null,this.dispatchEvent(new SMEvent(SMEvent.CONNECTCOMPLETE,null,null))},e.prototype.restartError=function(){null==this.restartKey&&this.dispatchEvent(new SMEvent(SMEvent.RESTARTCONNECT,null,null))},e.prototype.restart=function(){null==this.restartKey&&(this.restartKey=egret.setInterval(function(){this.dispatchEvent(new SMEvent(SMEvent.RESTARTCONNECT,null,null))},this,3e3))},e.prototype.onReceiveMessage=function(t){var e=this.socket.readUTF();if(e){var i=JSON.parse(e);"heart"!==i.t&&console.log("data: ",i),this.dispatchEvent(new SMEvent(SMEvent.GAMEMESSAGE,i))}},e.prototype.sendMessage=function(t,e){var i={t:t,d:e},n=JSON.stringify(i);this.socket&&this.socket.connected?(console.log("%cwrite-----","color:violet",n),this.socket.writeUTF(n)):this.activeClosed||this.restart()},e.prototype.onClose=function(){this.restart()},e.prototype.closeSocket=function(){this.socket.close()},e}(egret.DisplayObjectContainer);__reflect(SocketManager.prototype,"SocketManager");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function o(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var HallLayer=function(t){function e(){var e=t.call(this)||this;return e.skinName="hallLayerSkin",e.createGameScene(),e}return __extends(e,t),e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.createGameScene=function(){egret.localStorage.setItem("bull_roomNo",""),this.img_girl.x=200,egret.Tween.get(this.img_girl).to({x:656},1e3,egret.Ease.circOut),this.buttonCreateRoom.x=1400,this.buttonCreateRoom.alpha=0,egret.Tween.get(this.buttonCreateRoom).to({x:1266,alpha:1},1e3,egret.Ease.circOut),this.buttonJoinRoom.x=1500,this.buttonJoinRoom.alpha=0,egret.Tween.get(this.buttonJoinRoom).wait(100).to({x:1266,alpha:1},1e3,egret.Ease.circOut),this.buttonJoinRoomQuick.x=1600,this.buttonJoinRoomQuick.alpha=0,egret.Tween.get(this.buttonJoinRoomQuick).wait(200).to({x:1266,alpha:1},1e3,egret.Ease.circOut),this.checkMusic(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touch,this)},e.prototype.touch=function(t){switch(t.target){case this.buttonCreateRoom:SoundManager.playEffect("tap_open"),Main.Stage.dispatchEvent(new GEvent(GEvent.CREATE_ROOM));break;case this.buttonJoinRoom:SoundManager.playEffect("tap_join"),Main.Stage.dispatchEvent(new GEvent(GEvent.JOIN_ROOM));break;case this.buttonJoinRoomQuick:SoundManager.playEffect("tap_join"),Main.Stage.dispatchEvent(new GEvent(GEvent.JOIN_ROOM_QUICK));break;case this.btn_record:SoundManager.playEffect("tap_help"),GameController.getInstance().C_SEND_ZHANJI();break;case this.menuHelp:SoundManager.playEffect("tap_help"),Main.Stage.dispatchEvent(new GEvent(GEvent.HALL_HELP));break;case this.menuAnnounce:if(SoundManager.playEffect("tap_anc"),AnnouncePanel._instance)return AnnouncePanel._instance.visible=!0,void(AnnouncePanel._instance.enabled=!0);this.addChild(AnnouncePanel.getInstance());break;case this.menuQuit:SoundManager.playEffect("tap_back");this.basePanel&&this.basePanel.parent&&(this.basePanel.parent.removeChild(this.basePanel),this.basePanel=null),this.basePanel=new BasePanel({content:"您真的不玩了吗？",okFunc:function(){egret.localStorage.setItem("bull_userOpenId",""),egret.localStorage.setItem("ticket",""),window.location.href=Config.YXDT_URL}}),this.addChild(this.basePanel);break;case this.menuMusic:SoundManager.playEffect("tap"),this.changeMusic()}},e.prototype.updata=function(t){var e=t.d.i;if(e){var i=e.avatar,n=e.nickname,o=e.uid+"",r=e.cards+"",s=e.cash+"";Config.USER_OPEN_ID=o;var a=new egret.Shape;a.graphics.beginFill(255),a.graphics.drawCircle(0,0,56),a.graphics.endFill(),a.x=198,a.y=963,this.addChild(a),this.avatarImg.mask=a,RES.getResByUrl(i,function(t){var e=t;this.avatarImg.texture=e},this,RES.ResourceItem.TYPE_IMAGE),this.nameLabel.text=n,this.idLabel.text="ID: "+o,this.roomCardLabel.text=Utils.formatScoreForRead(r),this.roomCashLabel.text=Utils.formatScoreForRead(s)}},e.prototype.changeMusic=function(){SoundManager.enableSound=!SoundManager.enableSound,SoundManager.enableEffect=!SoundManager.enableEffect,egret.localStorage.setItem("enableSound",SoundManager.enableSound.toString()),egret.localStorage.setItem("enableEffect",SoundManager.enableEffect.toString()),SoundManager.enableSound&&SoundManager.enableSound?SoundManager.playBgSound("bg_hall"):SoundManager.stopSound()},e.prototype.checkMusic=function(){SoundManager.playBgSound("bg_hall");var t=egret.localStorage.getItem("enableSound"),e=egret.localStorage.getItem("enableEffect");SoundManager.enableSound="true"==t?!0:!1,SoundManager.enableEffect="true"==e?!0:!1,SoundManager.enableSound&&SoundManager.enableSound?(this.menuMusic.selected=!1,SoundManager.playBgSound("bg_hall")):(this.menuMusic.selected=!0,SoundManager.stopSound())},e.prototype.createImageByName=function(t){var e=new eui.Image,i=RES.getRes(t);return e.texture=i,e},e}(eui.Component);__reflect(HallLayer.prototype,"HallLayer");var PageLayer=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.createGameScene,e),e}return __extends(e,t),e.getInstance=function(){return e._instance||(e._instance=new e,window.page=e._instance),e._instance},e.prototype.createGameScene=function(){Main.Stage.addEventListener(GEvent.ROOM,this.swichPage,this),Main.Stage.addEventListener(GEvent.PLAYER_SIT_DOWN,this.swichPage,this),Main.Stage.addEventListener(GEvent.HALL_HELP,this.swichPage,this),Main.Stage.addEventListener(GEvent.CREATE_ROOM,this.swichPage,this),Main.Stage.addEventListener(GEvent.JOIN_ROOM,this.swichPage,this),Main.Stage.addEventListener(GEvent.JOIN_ROOM_QUICK,this.swichPage,this),Main.Stage.addEventListener(GEvent.ROOM_RECORD,this.swichPage,this)},e.prototype.showTips=function(t){this.tips&&this.tips.parent?this.tips.setTipsText(t):(this.tips=new TipsComponent,this.addChildAt(this.tips,9),this.tips.setTipsText(t)),this.timerTips=setTimeout(function(){this.hideTips()}.bind(this),3e3)},e.prototype.hideTips=function(){this.tips&&this.tips.parent&&(clearTimeout(this.timerTips),this.tips.parent.removeChild(this.tips))},e.prototype.showLoading=function(){},e.prototype.hideLoading=function(){},e.prototype.hidePage=function(){this.removeChildren()},e.prototype.swichPage=function(t){var e=t.d,i=(t.t,e?e.d:null),n=t.type;switch(console.log("%cPageLayer Swich Page \nEventType:","color:green",n),this.removeChildren(),n){case GEvent.ROOM:this.roomView=RoomUI.getInstance(),RoomUI.getInstance().updata(i),this.addChild(this.roomView);break;case GEvent.CREATE_ROOM:this.createRoomPanel=CreateRoomPanel.getInstance(),this.addChild(this.createRoomPanel);break;case GEvent.JOIN_ROOM:this.joinRoomPanel=null,this.joinRoomPanel=new JoinRoomPanel,this.addChild(this.joinRoomPanel);break;case GEvent.JOIN_ROOM_QUICK:this.JoinRoomQuickRanel=JoinRoomQuickRanel.getInstance(),this.addChild(this.JoinRoomQuickRanel);break;case GEvent.HALL_HELP:this.hallHelp=HallHelp.getInstance(),this.addChild(this.hallHelp);break;case GEvent.GAME_OVER_SUCCESS:}},e}(eui.Component);__reflect(PageLayer.prototype,"PageLayer");var HallHelp=function(t){function e(){var e=t.call(this)||this;return e.helpList=[],e.hallHelpList=[],e.addEventListener(eui.UIEvent.COMPLETE,e.createGameScene,e),e.skinName="hallHelpUISkin",e.initHallHelpList(),e}return __extends(e,t),e.getInstance=function(){return null==this._instance&&(this._instance=new e),e._instance},e.prototype.createGameScene=function(){var t=this;this.removeEventListener(eui.UIEvent.COMPLETE,this.createGameScene,this),this.rectBg.ellipseWidth=10,this.rectBg.ellipseHeight=10,this.initHelpContentList(),this.backToHall.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){PageLayer.getInstance().hidePage(),t.validateNow()},this)},e.prototype.initHelpContentList=function(){var t=new eui.VerticalLayout;t.gap=20;var e=this.hallHelpList?this.hallHelpList:[],i=new eui.ArrayCollection(e);this.helpContentList.layout=t,this.helpContentList.dataProvider=i,this.helpContentList.itemRenderer=HallHelpItem},e.prototype.initHallHelpList=function(){this.hallHelpList.push({title:"游戏功能",subTitle:"1、游戏大厅",subTitle1:"【创建房间】：可以通过创建房间按钮来创建一个游戏房间，邀请朋友进行牌局。",subTitle2:"【加入房间】：如果有好友邀请创建好了牌局，可通过房间号码找到并加入到该房间，参与游戏。",subTitle3:"【快速开始】：可随时加入到当前开放的游戏房间中。",imgUrl:"item_help_1_png"}),this.hallHelpList.push({title:"",subTitle:"2、定庄",subTitle1:"定庄游戏，房间创建者即为庄家，期间不可以换庄。",subTitle2:"",subTitle3:"",imgUrl:"item_help_2_png"}),this.hallHelpList.push({title:"",subTitle:"3、抢庄",subTitle1:"您可以创建抢庄房间，游戏开始，参与者每一轮都会有抢庄的机会轮流坐庄。",subTitle2:"",subTitle3:"",imgUrl:"item_help_3_png"}),this.hallHelpList.push({title:"",subTitle:"4、开放房间",subTitle1:"创建房间时若不勾选此选项，则所有用户均可以通过“快速开始”参与到您开设的房间中进行游戏。",subTitle2:"",subTitle3:"",imgUrl:"item_help_4_png"}),this.hallHelpList.push({title:"游戏规则",subTitle:"1、没牛",subTitle1:"玩家手中的五张扑克牌中，没有任意三张牌可以组成10的整数倍（如：10、20、30等，花牌按照10来计算），这种情况为“无牛”。",subTitle2:"",subTitle3:"",imgUrl:"item_help_5_png"}),this.hallHelpList.push({title:"",subTitle:"2、有牛",subTitle1:"玩家手中的五张扑克牌中，任意三张牌可以组成10的整数倍（如：10、20、30等，花牌按照10来计算），这种情况为“有牛”。",subTitle2:"如图，牌面的 10+Q+Q（或J或K）= 30 点，为10的整数倍，为有牛。",subTitle3:"",imgUrl:"item_help_6_png"}),this.hallHelpList.push({title:"",subTitle:"3、比牌规则",subTitle1:"游戏中设置闲家与庄家，比牌在所有闲家与庄家之间进行。比牌规则（见下面牌型加倍示例）为中牛大小。",subTitle2:"相同牛牌型比牌时，按照牌面数字比较，数字大者赢（K最大，A最小）。若最大牌面数字相同，则按照黑红梅方的顺序比较（黑桃最大，方片最小）。",subTitle3:"庄家与闲家均无牛，且双方最大牌数字小于或者等于10，则庄家赢。",imgUrl:""}),this.hallHelpList.push({title:"",subTitle:"4、抢庄加倍",subTitle1:"在抢庄模式游戏中，所有玩家均可参与抢庄。",subTitle2:"给出倍数高者坐庄，若有用户给出相同的倍数，则在该倍数下的用户相同随机分配坐庄。",subTitle3:"",imgUrl:"item_help_8_png"}),this.hallHelpList.push({title:"",subTitle:"5、下注加倍",subTitle1:"闲家在牌局开始时，可以根据已开牌面适当选择下注倍数，以博取最大的奖励。",subTitle2:"",subTitle3:"",imgUrl:"item_help_9_png"}),this.hallHelpList.push({title:"",subTitle:"6、牌型加倍",subTitle1:"牌型本身分为1倍、2倍、3倍，三个档次的倍率，具体如图。",subTitle2:"",subTitle3:"",imgUrl:"item_help_10_gif"}),this.hallHelpList.push({title:"",subTitle:"7、计算结果",subTitle1:"定庄模式的结果为：底注 x 闲家下注倍数 x 牌型倍数。",subTitle2:"抢庄模式的结果为：底注 x 庄家下注倍数 x 闲家下注倍数 x 牌型倍数。",subTitle3:"",imgUrl:""})},e}(eui.Component);HallHelp._instance=null,__reflect(HallHelp.prototype,"HallHelp");var HallHelpItem=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.uiCompHandler,e),e.skinName="HallHelppItemRenderSkin",e}return __extends(e,t),e.prototype.uiCompHandler=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this)},e.prototype.dataChanged=function(){this.height=350;var t=150;this.itemTitle.text=this.data.title,t+=this.itemTitle.height,this.itemSubTitle.text=this.data.subTitle,t+=this.itemSubTitle.height,this.itemSubTitle1.text=this.data.subTitle1,""!=this.data.subTitle1&&(t+=this.itemSubTitle1.height),this.itemSubTitle2.text=this.data.subTitle2,""!=this.data.subTitle2&&(t+=this.itemSubTitle2.height),this.itemSubTitle3.text=this.data.subTitle3,""!=this.data.subTitle3&&(t+=this.itemSubTitle3.height),"2、有牛"==this.itemSubTitle.text?this.itemSubTitle2.y+=40:"3、比牌规则"==this.itemSubTitle.text&&(this.itemSubTitle2.y+=40,this.itemSubTitle3.y+=80),this.itemImg.texture=RES.getRes(this.data.imgUrl),this.data.imgUrl&&(this.itemImg.top=t,this.height+=this.itemImg.height,"item_help_10_gif"==this.data.imgUrl&&(this.itemImg.scaleX=1.3,this.itemImg.scaleY=1.3,this.height+=.2*this.itemImg.height))},e}(eui.ItemRenderer);__reflect(HallHelpItem.prototype,"HallHelpItem");var RoomRecord=function(t){function e(e){var i=t.call(this)||this;return i.info=e.d.r,i.recordInfo=e.d.p,i.addEventListener(eui.UIEvent.COMPLETE,i.createGameScene,i),i.skinName="RoomRecordUISkin",console.log("info",i.info,"recordInfo",i.recordInfo),i}return __extends(e,t),e.getInstance=function(t){return e._instance||(e._instance=new e(t)),e._instance},e.prototype.update=function(t){this.roomNo.text=this.info.rid,this.roomDate.text=Utils.timeToDate(this.info.time),this.recordInfo=t.d},e.prototype.createGameScene=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.createGameScene,this),this.buttonBackHall.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.goToHall,this),this.noticeLabel.text="用手机截屏保存战绩，分享给小伙伴吧~",0==this.recordInfo.length?this.noRecordText.visible=!0:this.noRecordText.visible=!1,this.roomNo.text=this.info.rid,this.roomDate.text=Utils.timeToDate(this.info.time),this.initRoomRecordList()},e.prototype.goToHall=function(){RoomUI.getInstance().ResultClear(),this.validateNow()},e.prototype.initRoomRecordList=function(){var t=new eui.ArrayCollection(this.recordInfo),e=new eui.HorizontalLayout;e.gap=15;var i=this.roomRecordList;i.layout=e,i.dataProvider=t,i.itemRenderer=RoomRecordItemRenderer;var n=new eui.Scroller;n.viewport=i,n.x=50,n.y=286,n.width=1820,n.height=610,this.addChild(n)},e}(eui.Component);__reflect(RoomRecord.prototype,"RoomRecord");var RoomRecordItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="recordItemRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){console.log("change"),this.avatarImg.source=("test"==Config.ENV?Config.AVATAR_URL_TEST:Config.AVATAR_URL)+this.data.avatar,this.nameLabel.text=this.data.nickname,this.killNum.text=this.data.killall+"",this.bullNum.text=this.data.nn+"",this.winNum.text=this.data.win+"",this.loseNum.text=this.data.lose+"",this.totalScore.text=String(this.data.score).split(".")[0],this.initAvatarMask()},e.prototype.initAvatarMask=function(){this.avatarImg.mask=this.rect_mask,this.iconWin.visible=this.data.score>0?!0:!1},e}(eui.ItemRenderer);__reflect(RoomRecordItemRenderer.prototype,"RoomRecordItemRenderer");
var RoomUI=function(t){function e(){var e=t.call(this)||this;return e.curNo=0,e.totalNo=0,e.got2016={},e.lock_start=!1,e.tweenRunningTotal=0,e.flagGameOver=0,e.skinName="roomUISkin",window.roomUI=e,e}return __extends(e,t),e.getInstance=function(){return null==this._instance&&(this._instance=new e),e._instance},e.prototype.updata=function(t){this.dataDetail=t,this.roomData=this.dataDetail.r,this.roomType=+this.roomData.model,this.createGameScene()},e.prototype.createGameScene=function(){this.setCurrentTime(),this.checkMusic(),this.addControlBar(),this.addClock(),this.setRoomInfo(),this.checkMyself(),this.addPlayers(),this.gp_score=[this.gp_score_0,this.gp_score_1,this.gp_score_2,this.gp_score_3,this.gp_score_4],this.gp_score_0.visible=!1,this.gp_score_1.visible=!1,this.gp_score_2.visible=!1,this.gp_score_3.visible=!1,this.gp_score_4.visible=!1,SoundManager.playBgSound("bg_room"),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touch,this),this.recoverStatus()},e.prototype.recoverStatus=function(){var t=this,i=this.dataDetail.pl.filter(function(t){return"1"===t.start}),n=this.dataDetail.p.filter(function(t){return 3==t.p.length}).length>0,o="0"===this.roomData.banker?null:this.roomData.banker;if(!i||n||o){if(i&&n&&!o)this.showControlBar("banker"),e.getInstance().dealHandCards(this.dataDetail.p);else if(i&&n&&o){this.showControlBar("times");var r=this.playersList.filter(function(t){return t.data.uid==String(o)})[0];e.getInstance().dealHandCards(this.dataDetail.p,o),r.setBanker(!0),r.setGrabBankerStatus(!0),r.showBanker()}}else i.forEach(function(e){var i={uid:e.uid,pos:e.pos};e.uid==Config.USER_OPEN_ID?t.playerPrepared():t.playerPrepared(i)})},e.prototype.removePlayers=function(){for(var t=this.playersList,e=t.length,i=0;e>i;i++){var n=this.playersList[i];n&&n.parent&&n.parent.removeChild(n)}this.playersList=[]},e.prototype.setCurrentTime=function(){var t=this,e=function(){var i=Utils.getCurTime();t.currentTime.text=i,clearTimeout(t.myTime),t.myTime=setTimeout(e,1e3)};clearTimeout(this.myTime),this.myTime=setTimeout(e,1e3)},e.prototype.setRoomInfo=function(){this.roomInfo(this.roomData,!0),this.bankerStatus.visible=!0;var t=1==+this.roomData.model?"qiang":"ding";this.bankerStatus.source="v2_tips_tit_"+t},e.prototype.addClock=function(){this.timeOutClock=new TimeOutClock,this.timeOutClock.horizontalCenter=-10,this.timeOutClock.verticalCenter=-20,this.addChild(this.timeOutClock),this.timeOutClock.visible=!1},e.prototype.addControlBar=function(){this.userControlBar=new UserControlBar,this.userControlBar.horizontalCenter=0,this.userControlBar.bottom=0,this.addChildAt(this.userControlBar,2)},e.prototype.roomInfo=function(t,e){if(t&&(this.curNo=+t.cr,this.totalNo=+t.round,e)){var i="第"+t.cr+"/"+t.round+"局";this.currentNumber.text=i,this.roomNo.text=t.rid,this.basicAmount.text=t.bet}},e.prototype.hideChatPannel=function(){this.chatPanel&&(this.chatPanel.visible=!1,this.chatPanel.enabled=!1)},e.prototype.checkMusic=function(){var t=egret.localStorage.getItem("enableSound"),e=egret.localStorage.getItem("enableEffect");SoundManager.enableSound="true"==t?!0:!1,SoundManager.enableEffect="true"==e?!0:!1,SoundManager.enableSound&&SoundManager.enableSound?(this.buttonMusic.selected=!1,SoundManager.playBgSound("room")):(this.buttonMusic.selected=!0,SoundManager.stopSound())},e.prototype.checkMyself=function(){SeatManager.getInstance().setMySeatId(+this.dataDetail.pl.filter(function(t){return t.uid==Config.USER_OPEN_ID})[0].pos)},e.prototype.addPlayers=function(){var t=this;this.playersInfo=new eui.ArrayCollection(this.dataDetail.pl),this.playersList=new Array(5);this.playersInfo.length;console.log(this.playersInfo),this.playersInfo.source.forEach(function(e){var i=new Player(e);1===+e.banker&&(i.setBanker(!0),i.setGrabBankerStatus(!0),i.showBanker()),i.parent&&i.parent.removeChild(i);var n=i.getPosId();t.addChildAt(i,10+ +e.pos),t.playersList[n]=i}),1===+this.roomData.status&&(this.hideBankerStatus(),this.dealHandCards(this.dataDetail.pl)),egret.localStorage.removeItem("opt")},e.prototype.addPlayer=function(t){if(String(t.uid)==String(Config.USER_OPEN_ID)){var e=this.getCacheStatus("opt");"times"==e?(this.showControlBar("times"),this.showClock("times"),console.log("times1")):"banker"==e&&(this.showControlBar("banker"),this.showClock("banker"))}var i=new Player(t),n=i.getPosId(),o=this.playersList;if(o[n]){clearTimeout(Config.TIMER_PLAYER_OUT);var r=o[n];String(t.uid)==r.data.uid?t.handCards.length&&(i.hidePrepared(),i.setCardType(t.result),i.dealHandCards(t.handCards)):(r.parent.removeChild(r),r=null,o[n]=i,this.addChildAt(i,10+n))}else{for(var s=0;s<o.length;s++)if(o[s]&&o[s].data.uid==i.data.uid){o[s].parent&&o[s].parent.removeChild(o[s]);break}this.playersList[n]=i,this.addChildAt(i,10+n)}},e.prototype.removePlayer=function(t){console.log("有玩家退出房间",t);for(var e=this.playersList.length,i=0;e>i;i++){var n=this.playersList[i];null!=n&&n.getSeatId()==t.pos&&n.parent&&(n.parent.removeChild(n),this.playersList[n.getPosId()]=null)}},e.prototype.playerPrepared=function(t){this.got2016={},t||this.showRoomTips("等待其他玩家准备...");var e=t?SeatManager.getInstance().getPosId(t.p):0,i=this.playersList[e];i&&i.setPrepared(),0==e&&(this.hideControlBar(),this.hideBankerStatus())},e.prototype.startGameOfBanker=function(t,e){if(!this.lock_start){var i="第"+t.r.cr+"/"+t.r.r+"局";this.currentNumber.text=i;var n=t.p;this.lock_start=!0,this.hideRoomTips(),this.setCacheStatus("opt","banker"),this.playersBet=parseInt(t.r.r),Config.ROOM_START_GAME=!0;var o=this;this.animateStartGame=new StartGame(null,function(){o.dealPokersOfBanker(n,e)}),this.animateStartGame.verticalCenter=0,this.animateStartGame.horizontalCenter=0,this.addChild(this.animateStartGame)}},e.prototype.setCacheStatus=function(t,e){var i=new Date,n=e+":"+i.getTime();egret.localStorage.setItem(t,n)},e.prototype.dealPokersOfBanker=function(t,e){this.hideClock(),this.hideControlBar(),this.hideRoomTips(),this.hideBankerStatus();for(var i=[],n=t.length,o=0;3>o;o++)for(var r=0;n>r;r++)if(t[r]){var s=SeatManager.getInstance().getPosId(t[r].pos);i.push([s,o])}this.dealPoker&&this.dealPoker.parent&&(this.dealPoker.parent.removeChild(this.dealPoker),this.dealPoker=null),this.dealPoker=new DealPoker(i,e),this.addChild(this.dealPoker)},e.prototype.playerGrabBanker=function(t){var e,i,n;t&&(e=0,i=this.playersList[e],n=parseInt(t.timesNo)),t&&t.pos&&(e=SeatManager.getInstance().getPosId(t.pos),i=this.playersList[e],n=parseInt(t.bet)),i&&(n||(n=0),i.setGrabBanker(!!n),i.showTips("banker",n),0==e&&(egret.localStorage.removeItem("opt"),this.hideClock(),this.hideControlBar(),this.showRoomTips("等待其他玩家抢庄...")))},e.prototype.playerAllotBanker=function(t){this.hideRoomTips(),this.hideScoreTips(),console.log("上庄",t);var e=t.p;if(e)for(var i=0;i<e.length;i++)if(String(e[i].uid)==String(Config.USER_OPEN_ID)){clearTimeout(this.timerLoginOut),this.playersBet=parseInt(e[i].bet);break}var n=t.banker;if(1==this.roomType){for(var i=0;i<t.banker.candidate.length;i++){var o=SeatManager.getInstance().getPosId(t.banker.candidate[i]),r=this.playersList[o];r.setGrabBanker(!0),r.showTips("banker",e[i].bet)}this.startGame(n)}else Config.ROOM_START_GAME=!0,this.animateStartGame=new StartGame(n,null),this.animateStartGame.verticalCenter=0,this.animateStartGame.horizontalCenter=0,this.addChild(this.animateStartGame)},e.prototype.startGame=function(t){for(var e=[],i=this.playersList.length,n=0;i>n;n++){var o=this.playersList[n];o&&(1==this.roomType?t.uid==Config.USER_OPEN_ID&&(this.hideControlBar(),this.hideClock()):(o.hidePrepared(),o.getSeatId()==t.pos&&(o.setBanker(!0),o.setGrabBankerStatus(!0),this.showControlBar("times"),this.playerShowBanker(t)))),o&&o.getGrabBanker()&&e.push(o)}1==this.roomType?this.animateAllotBanker(e,t):t.uid!=Config.USER_OPEN_ID?this.userControlBar.showTimesBar():this.showRoomTips("等待其他玩家下注...")},e.prototype.animateAllotBanker=function(t,e){var i,n=this,o=0,r=100,s=t.length,a=0,l=s-1,h=5*s,c=1,u=!1,p=0;if(1==s)u=!0,p=0;else{for(var d=0,g=0;s>g;g++)String(t[g].data.bet)==String(e.bet)&&(d++,p=g);u=1==d}if(u)t[p].setBanker(!0),t[p].showGrabBanker(),SoundManager.playEffect("banker_round"),setTimeout(function(){n.playerShowBanker(e)},500);else{var m=function(){if(SoundManager.playEffect("banker_round"),t[a].showGrabBanker(),t[l].hideGrabBanker(),t[a].getOpenId()==e.openId&&(t[a].setBanker(!0),o=a),r+=10,a++,l=a-1,a=a>=s?0:a,!(h>c)){t[o].setGrabBankerStatus(!0);for(var u=0;s>u;u++)t[u].hideGrabBanker();return t[o].showGrabBanker(),clearTimeout(i),void setTimeout(function(){n.playerShowBanker(e)},500)}c++,clearTimeout(i),i=setTimeout(m,r)};clearTimeout(i),i=setTimeout(m,r)}},e.prototype.playerShowBanker=function(t){for(var e=this.playersList.length,i=0;e>i;i++){var n=this.playersList[i];n&&0==n.getPosId()&&n.data.uid!=t.uid&&(this.setCacheStatus("opt","times"),this.showControlBar("times"),this.showClock("times"),console.log("times2")),n&&(String(n.data.pos)==String(t.pos)?(n.setBanker(!0),n.showBanker(),1==this.roomType&&n.showTips("banker",t.bet)):(n.setBanker(!1),n.hideTips(),n.hideBanker()))}},e.prototype.playerChooseTimes=function(t){var e=t.timesNo?0:SeatManager.getInstance().getPosId(t.pos),i=this.playersList[e],n=t.timesNo?t.timesNo:t.bet;0==n&&(n=1),0==e&&(this.hideClock(),this.hideControlBar(),i.showMyAllCards(),this.showRoomTips("等待其他玩家下注...")),i&&n&&(i.setHadBet(!0),i.hideTips(),i.showTips("times","X"+n))},e.prototype.dealPokers=function(t,e){console.log("DATA-11",t),this.finishData=t,clearTimeout(this.timerLoginOut),egret.localStorage.removeItem("opt"),this.hideClock(),this.hideControlBar(),this.hideRoomTips();for(var i=[],n=t.length,o=[3,5],r=o[0];r<o[1];r++)for(var s=0;n>s;s++)if(t[s].p&&t[s].p.length){var a=SeatManager.getInstance().getPosId(t[s].pos);i.push([a,r])}this.dealPoker&&this.dealPoker.parent&&(this.dealPoker.parent.removeChild(this.dealPoker),this.dealPoker=null),this.dealPoker=new DealPoker(i,e),this.addChild(this.dealPoker);for(var l=0;n>l;l++){var a=SeatManager.getInstance().getPosId(t[l].pos),h=this.playersList[a];h&&t[l].p&&t[l].p.length&&(h.hideTips(),h.hidePrepared(),h.setCardType(t[l].result))}},e.prototype.checkPlayerBull=function(t){var e=this.playersList[0],i=e.getCardType();console.log("有牛",i),0==i?(this.hideClock(),this.hideControlBar(),e.showTips("note",String(i))):t.hasBull?(this.hideClock(),this.hideControlBar(),e.showTips("note",String(i)),this.showRoomTips("等待其他玩家算牌..."),this.playersList[0].showMyAllCards()):PageLayer.getInstance().showTips("再仔细看看~")},e.prototype.checkBull=function(t){var e=this.playersList[0],i=e.getCardType();0==i?e.showTips("note",String(i)):t?(this.hideControlBar(),e.showTips("note",String(i))):PageLayer.getInstance().showTips("再仔细看看~")},e.prototype.showPlayerChat=function(t){console.log("data",t);var e=t?SeatManager.getInstance().getPosId(t.pos):0;console.log("posId",e);var i=this.playersList[e];i.chatPop.show(t.text)},e.prototype.showAccountPanel=function(t){console.log("战绩DATA",t);var i=this;this.timerLoginOut=setTimeout(function(){egret.localStorage.removeItem("opt"),i.validateNow()},3e4),Config.ROOM_START_GAME=!1,this.hideRoomTips();for(var n=!1,o=0;o<t.length;o++){var r=t[o];if(r){var s=SeatManager.getInstance().getPosId(r.pos),a=this.playersList[s];a&&(a.showMyAllCards(),a.showTips("note",String(a.getCardType()))),r.uid==Config.USER_OPEN_ID&&r.p&&(n=!0)}}n?(this.playersList[0]&&this.playersList[0].showMyAllCards(),this.accoutingData=t,e.getInstance().tweenCoin(),this.addChild(new ResultPanel(t))):console.log("我没有参与本轮"),this.roomInfo(t,!1)},e.prototype.playerGetCalculate=function(t){if(this.userControlBar){t.selected?this.userControlBar.setCalculateValue("plus",parseInt(t.value)):this.userControlBar.setCalculateValue("minus",parseInt(t.value));var e=this.playersList[0];e.checkMyHandCards()}},e.prototype.showRoomTips=function(t){var e=this;this.timerRoomTips=setTimeout(function(){e.lb_tips.text=String(t),e.roomTips.visible=!0},500)},e.prototype.hideRoomTips=function(){clearTimeout(this.timerRoomTips),this.roomTips.visible=!1},e.prototype.getCacheStatus=function(t){var e="",i=egret.localStorage.getItem(t);if(i){var n=i.split(":"),o=new Date;o.getTime()-parseInt(n[1])<12e4&&(e=n[0])}return e},e.prototype.showControlBar=function(t){if(this.userControlBar)switch(t){case"prepare":this.userControlBar.hideAll(),this.userControlBar.showPrepare();break;case"banker":this.userControlBar.hideAll(),this.userControlBar.showBankersBar(this.playersBet);break;case"times":this.userControlBar.hideAll(),this.userControlBar.showTimesBar();break;case"bull":this.userControlBar.hideAll(),this.userControlBar.showBullBar();break;case"player":this.userControlBar.hideAll();break;case"calculate":this.userControlBar.showCalculateBar()}},e.prototype.showClock=function(t){console.log("此函数被调用",t),this.timeOutClock.visible=!0;var e=this,i=Config.TIMEOUT_PREPARE,n=Config.TIMEOUT_BANKER,o=Config.TIMEOUT_TIMES,r=Config.TIMEOUT_BULL;switch(t){case"prepare":this.timeOutClock.runTimeOut(i,function(){e.hideClock(),e.userControlBar.getReady()});break;case"banker":this.timeOutClock.runTimeOut(n,function(){e.hideClock(),GameController.getInstance().C_GRAB_BANKER(0);var t={timesNo:0};e.playerGrabBanker(t)});break;case"times":this.timeOutClock.runTimeOut(o,function(){e.hideClock(),GameController.getInstance().C_BET_TIMES("1");var t={timesNo:"1"};e.playerChooseTimes(t)});break;case"bull":this.timeOutClock.runTimeOut(r,function(){e.hideClock(),e.hideControlBar(),e.resetPokers();var t={hasBull:!0};e.checkPlayerBull(t),e.showAccountPanel(e.finishData)})}},e.prototype.resetPokers=function(){var t=this.playersList[0];t.resetMyCards()},e.prototype.hideControlBar=function(){this.userControlBar&&this.userControlBar.hideAll()},e.prototype.hideClock=function(){this.timeOutClock&&(this.timeOutClock.visible=!1,this.timeOutClock.clearTimeOut())},e.prototype.hideBankerStatus=function(){this.bankerStatus&&(this.bankerStatus.visible=!1)},e.prototype.hideScoreTips=function(){if(this.mask_score){this.mask_score.visible=!1;for(var t=0;t<this.gp_score.length;t++)this.resetScoreTips(t)}},e.prototype.resetScoreTips=function(t){var e=this.gp_score[t];e&&(e.visible=!1,e.removeChildren())},e.prototype.dealHandCards=function(t,e){this.lock_start=!1,console.log("翻牌-------------------",t),this.hideControlBar(),this.dealPoker&&this.dealPoker.parent&&(this.dealPoker.parent.removeChild(this.dealPoker),this.dealPoker=null),this.hideRoomTips();for(var i=0,n=t,o=n.length,r=!1,s=0;o>s;s++){var a=SeatManager.getInstance().getPosId(n[s].pos),l=this.playersList[a];l&&n[s].p&&n[s].p.length&&(r=!0,l.hidePrepared(),l.dealHandCards(n[s].p),n[s].uid==Config.USER_OPEN_ID&&(i=n[s].p.length,l.showMyThreeCards(),l.setMyCardsCanSelect()))}if(r){if(!i){this.showRoomTips("游戏已开始，请等待下一轮...");var l=this.playersList[0];l.setPrepared()}}else this.hideControlBar(),this.hideClock(),this.showControlBar("prepare");var h="p"in t[0]&&t.filter(function(t){return t.uid==Config.USER_OPEN_ID&&"p"in t})[0].p.length;if(i)if(1==this.roomType&&5>i){if(e)return this.showClock("times"),void this.userControlBar.showTimesBar();this.showControlBar("banker"),this.showClock("banker")}else this.dataDetail.r.banker==Config.USER_OPEN_ID?this.showRoomTips("等待其他玩家下注..."):(this.showClock("times"),this.userControlBar.showTimesBar()),5==h&&(this.showControlBar("bull"),this.showControlBar("calculate"),this.showClock("bull"))},e.prototype.tweenCoin=function(){for(var t,e,i=this.finishData,n=[],o=[],r=[],s=0;s<this.playersList.length;s++)if(this.playersList[s])for(var a=0;a<i.length;a++)if(String(i[a].uid)==String(this.playersList[s].data.uid)){0==s?(console.log("是庄家"),t=this.playersList[s],e=s,r=SeatManager.getInstance().getCoinPos(this.playersList[s].data.pos)):(console.log("不是庄家",i[a].score),i[a].score>0?n.push(SeatManager.getInstance().getCoinPos(this.playersList[s].data.pos).concat([s]).concat(["+"+parseInt(i[a].score)])):i[a].score<0&&o.push(SeatManager.getInstance().getCoinPos(this.playersList[s].data.pos).concat([s]).concat([""+parseInt(i[a].score)])));break}var l=this,h=0;o.length&&(setTimeout(function(){SoundManager.playEffect("bet")},600),setTimeout(function(){for(var t=0,i=0;i<o.length;i++){l.tweenCoinSingle(o[i],r);var n=Utils.formatScoreForRead(o[i][3]);l.showScoreTips(o[i][2],n),t+=Number(o[i][3])}var s=Utils.formatScoreForRead((0-t).toString());l.showScoreTips(e,"+"+s)},0),h=1500),n.length&&(setTimeout(function(){SoundManager.playEffect("bet")},600+h),setTimeout(function(){for(var t=0,i=0;i<n.length;i++){l.tweenCoinSingle(r,n[i]);var o=Utils.formatScoreForRead(n[i][3]);l.showScoreTips(n[i][2],"+"+o),t+=parseInt(n[i][3])}var s=Utils.formatScoreForRead(String(0-t));l.showScoreTips(e,s)},h)),this.updatePlayerScore(this.finishData)},e.prototype.updatePlayerScore=function(t){console.log("用户金额",t);for(var i=t,n=this.playersList.length,o=i.length,r=0;n>r;++r)for(var s=this.playersList[r],a=0;o>a;++a)if(s&&s.getOpenId()==i[a].uid){var l=i[a].uid,h=i[a].score;String(l)in e.total?e.total[l]+=parseInt(h):e.total[l]=parseInt(h),console.log("TOTAL",e.total),s.updateScore(e.total[l])}},e.prototype.createCoin=function(){var t;return this.coinPool||(this.coinPool=[]),t=this.coinPool.length?this.coinPool.shift():this.createImageByName("v2_icon_coin")},e.prototype.showScoreTips=function(t,e){this.resetScoreTips(t),this.gp_score[t].y+=60,e=String(e);var i="-"==e[0]?"b":"y",n=[];n.push(this.createImage()),"-"==e[0]?n[0].source="num_"+i+"_minus":"+"==e[0]&&(n[0].source="num_"+i+"_plus");for(var o=1;o<e.length;o++)n.push(this.createImage()),"."==e[o]?n[o].source="num_"+i+"_dot":"万"==e[o]?n[o].source="num_"+i+"_wan":n[o].source="num_"+i+"_"+e[o];for(var o=0;o<n.length;o++)n[o].x=28*o,this.gp_score[t].addChildAt(n[o],o+1);var r=this.createImage();r.source="num_"+i+"_bg",r.horizontalCenter=0,r.verticalCenter=0,r.width=28*n.length+40,r.height=42,this.gp_score[t].addChildAt(r,0),this.gp_score[t].width=r.width,this.gp_score[t].height=r.height,this.gp_score[t].scaleX=1.6,this.gp_score[t].scaleY=1.6,this.gp_score[t].visible=!0,this.mask_score.visible=!0;var s=this;this.tweenRunningTotal++,egret.Tween.get(this.gp_score[t]).to({y:this.gp_score[t].y-60},5e3,egret.Ease.circOut).call(function(){for(var e=0;e<n.length;e++)s.deleteImage(n[e]);s.resetScoreTips(t),s.tweenRunningTotal--,s.tweenEnd()})},e.prototype.tweenEnd=function(){this.tweenRunningTotal||(this.mask_score.visible=!1,this.accoutingData&&this.accoutingData.curNo==this.accoutingData.totalNo+1||this.flagGameOver&&(clearTimeout(this.timer_dismissRoom),this.userDismissRoom2Now()))},e.prototype.userDismissRoom2=function(){if(Config.ROOM_START_GAME){this.flagGameOver=1;var t=this;this.timer_dismissRoom=setTimeout(function(){t.userDismissRoom2Now()},3e4)}else this.userDismissRoom2Now()},e.prototype.userDismissRoom2Now=function(){PageLayer.getInstance().showTips("房间已经被解散"),this.validateNow(),setTimeout(function(){egret.localStorage.removeItem("bull_roomNo")},1e3)},e.prototype.gameAgain=function(){this.hideClock(),this.hideControlBar(),this.mask_score.visible=!1;for(var t=this.playersList.length,e=0;t>e;e++){var i=this.playersList[e];i&&i.reset()}},e.prototype.createImage=function(){var t;return this.imagePool||(this.imagePool=[]),t=this.imagePool.length?this.imagePool.shift():new eui.Image},e.prototype.deleteImage=function(t){this.imagePool||(this.imagePool=[]),this.imagePool.push(t)},e.prototype.createImageByName=function(t){var e=new eui.Image,i=RES.getRes(t);return e.texture=i,e},e.prototype.deleteCoin=function(t){this.coinPool||(this.coinPool=[]),this.coinPool.push(t)},e.prototype.tweenCoinSingle=function(t,e){for(var i=20,n=[],o=1;i>=o;o+=1){n[o]=this.createCoin(),n[o].x=t[0],n[o].y=t[1],n[o].scaleX=2,n[o].scaleY=2,n[o].pos_from_x=t[0]+Utils.rand(-40,40),n[o].pos_from_y=t[1]+Utils.rand(-40,40),this.addChild(n[o]),egret.Tween.get(n[o]).to({x:n[o].pos_from_x,y:n[o].pos_from_y},400,egret.Ease.circInOut)}for(var o=1;i>=o;o+=1){n[o].x=n[o].pos_from_x,n[o].y=n[o].pos_from_y,egret.Tween.get(n[o]).wait(500+500*o/i).to({x:e[0],y:e[1]},500,egret.Ease.circInOut).call(this.cleanAtTweenEnd,this,[n[o]])}},e.prototype.cleanAtTweenEnd=function(t){t&&t.parent&&t.parent.removeChild(t),this.deleteCoin(t)},e.prototype.powerClear=function(){this.removePlayers(),PageLayer.getInstance().hidePage(),this.ResultClear(),console.log("暴力清除")},e.prototype.ClearbasePanel=function(){this.basePanel&&this.basePanel.parent&&(this.basePanel.parent.removeChild(this.basePanel),this.basePanel=null)},e.prototype.Vote=function(t,e,i){this.ClearbasePanel();var n=1===t?"退出房间":"解散房间",o=i===parseInt(Config.USER_OPEN_ID)?!0:!1;this.basePanel=new BasePanel({content:e+"申请"+n,okStr:"同意",cancelStr:"拒绝",okFuncC:function(){GameController.getInstance().C_SEND_VOTE(t,1)},cancelFuncC:function(){GameController.getInstance().C_SEND_VOTE(t,0)}},o),this.addChild(this.basePanel)},e.prototype.touch=function(t){switch(t.target){case this.buttonMusic:SoundManager.enableSound=!SoundManager.enableSound,SoundManager.enableEffect=!SoundManager.enableEffect,egret.localStorage.setItem("enableSound",SoundManager.enableSound.toString()),egret.localStorage.setItem("enableEffect",SoundManager.enableEffect.toString()),SoundManager.enableSound&&SoundManager.enableSound?SoundManager.playBgSound("bg_room"):SoundManager.stopSound();break;case this.buttonQuit:var i=this.roomData.is_create,n="1"===this.roomData.type?!0:!1;SoundManager.playEffect("tap_back");i==Config.USER_OPEN_ID?Config.ROOM_START_GAME?PageLayer.getInstance().showTips("游戏已开始，不能退出哦~"):(this.ClearbasePanel(),n||this.roomPattern?this.basePanel=new BasePanel({content:"您确定要申请解散房间吗？",okFunc:function(){GameController.getInstance().C_SEND_DISSOLVE_ROOM()}}):this.basePanel=new BasePanel({content:"您是房主，若退出房间将自动解散哦！",okFunc:function(){egret.localStorage.removeItem("opt"),GameController.getInstance().C_SEND_DISSOLVE_ROOM(),e.getInstance().powerClear()}}),this.addChild(this.basePanel)):Config.ROOM_START_GAME?PageLayer.getInstance().showTips("游戏已开始，不能退出哦~"):(this.ClearbasePanel(),n?this.basePanel=new BasePanel({content:"您确定要申请退出房间吗？",okFunc:function(){GameController.getInstance().C_SEND_EXIT_ROOM()}}):this.basePanel=new BasePanel({content:"退出后系统会帮您打完这局，您确定要退出房间吗？",okFunc:function(){egret.localStorage.removeItem("opt"),GameController.getInstance().C_SEND_EXIT_ROOM(),e.getInstance().powerClear()}}),this.addChild(this.basePanel));break;case this.buttonChat:if(SoundManager.playEffect("tap"),this.chatPanel)return this.chatPanel.visible=!0,void(this.chatPanel.enabled=!0);this.chatPanel=new RoomChatPanel,this.chatPanel.alpha=.8,this.addChild(this.chatPanel);break;case this.buttonInvite:SoundManager.playEffect("tap"),PageLayer.getInstance().showTips("点击右上角菜单，分享给小伙伴吧")}},e.prototype.Result=function(t){this.RoomRecord=RoomRecord.getInstance(t)},e.prototype.ResultTrue=function(){this.addChild(this.RoomRecord)},e.prototype.ResultClear=function(){e.total={},e._instance=null,this.roomPattern=null;try{this.parent.removeChild(this)}catch(t){console.log(t)}},e}(eui.Component);RoomUI._instance=null,RoomUI.total={},__reflect(RoomUI.prototype,"RoomUI");var AnnouncePanel=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.uiCompHandler,e),e.skinName="resource/eui_skins/skins/panel/announcePanelSkin.exml",e}return __extends(e,t),e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.uiCompHandler=function(){console.log("AnnouncePanel Complete"),this.rectBg.ellipseWidth=30,this.rectBg.ellipseHeight=30,this.ancLabel1.text="严禁赌博公告：",this.ancLabel2.text="本游戏仅为娱乐休闲使用，自觉远离赌博等非法行为。请各位玩家文明娱乐，远离赌博，如发现有赌博行为，封停账号，并向公安机关举报。",this.ancLabel2.lineSpacing=10,this.closePanel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeFunc,this)},e.prototype.closeFunc=function(){this.visible=!1,this.enabled=!1},e}(eui.Panel);__reflect(AnnouncePanel.prototype,"AnnouncePanel");var GameController=function(t){function e(){var e=t.call(this)||this;return e.HEART_TIMEOUT=4e3,e.SM=new SocketManager,e.SM.addEventListener(SMEvent.GAMEMESSAGE,e.readMessage,e),e.SM.addEventListener(SMEvent.CONNECTCOMPLETE,e.startGame,e),e.SM.addEventListener(SMEvent.RESTARTCONNECT,e.restart,e),e.checkToken(),e}return __extends(e,t),e.getInstance=function(){return null==this._instance&&(this._instance=new e),e._instance},e.prototype.checkToken=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){try{this.SM.connectServer(Config.SOCKET_URL,Config.SOCKET_PORT)}catch(e){egret.error(e)}return[2]})})},e.prototype.readMessage=function(t){var e=t.t,i=t.d,n=i.d;switch(e){case CMD.SERVER_COMMAND_ENTER:this.dispatchEvent(new GEvent(GEvent.RECEIVE,i));break;case CMD.SERVER_COMMAND_JOIN:RoomUI.getInstance().addPlayer(n.p[0]),console.log("dataDetail",n,"dataDetail.p",n.p);break;case CMD.SERVER_COMMAND_READY:RoomUI.getInstance().playerPrepared(n);break;case CMD.SERVER_COMMAND_START:RoomUI.getInstance().startGameOfBanker(n,function(){RoomUI.getInstance().dealHandCards(n.p)});break;case CMD.SERVER_COMMAND_BANKER:RoomUI.getInstance().playerAllotBanker(n);break;case CMD.SERVER_COMMAND_BET:RoomUI.getInstance().playerChooseTimes(n);break;case CMD.SERVER_COMMAND_FINISH:RoomUI.getInstance().dealPokers(n.p,function(){RoomUI.getInstance().dealHandCards(n.p)});break;case CMD.SERVER_COMMAND_CHAT:RoomUI.getInstance().showPlayerChat(n);break;case CMD.SERVER_COMMAND_EXIT:console.log("exitroom",i.d.uid,Config.USER_OPEN_ID),i.d.uid===parseInt(Config.USER_OPEN_ID)?(console.log("退出的是自己就删除界面"),PageLayer.getInstance().hidePage(),RoomUI.getInstance().ResultClear(),RoomUI.getInstance().userDismissRoom2()):(RoomUI.getInstance().ClearbasePanel(),RoomUI.getInstance().removePlayer(n));break;case CMD.SERVER_COMMAND_HISTORY:if(1===i.d.p)HallLayer.getInstance().addChild(recentRecord.getInstance(i));else{if(!i.d.l)return;recentRecord._instance.NextRecord(i)}break;case CMD.SERVER_COMMAND_HISTORY_DES:if(1===i.d.p)recentRecord._instance.addChild(recordDetails.getInstance(i));else{if(!i.d.l)return;recordDetails._instance.NextRecord(i)}break;case CMD.SERVER_COMMAND_KICK:this.kickGame();break;case CMD.SERVER_COMMAND_ERROR:PageLayer.getInstance().showTips(n.m);break;case CMD.SERVER_COMMAND_RESULT:console.log("50局打完，清理房间数据"),RoomUI.getInstance().Result(i);break;case CMD.SERVER_COMMAND_VOTE:RoomUI.getInstance().Vote(i.d.e,i.d.n,i.d.u);break;case CMD.SERVER_COMMAND_VR:break;case CMD.SERVER_COMMAND_cVOTE:RoomUI.getInstance().ClearbasePanel();break;case CMD.SERVER_COMMAND_DISSOLVEROOM:PageLayer.getInstance().hidePage(),RoomUI.getInstance().ResultClear(),RoomUI.getInstance().userDismissRoom2()}},e.prototype.kickGame=function(){this.SM.closeSocket(),PageLayer.getInstance().hidePage(),PageLayer.getInstance().showTips("您已在其他设备登陆！"),setTimeout(function(){window.location.href=Config.YXDT_URL},3e3)},e.prototype.startGame=function(t){this.C_HEART_BEAT(),this.C_LOGIN()},e.prototype.restart=function(t){},e.prototype.C_LOGIN=function(){var t={ticket:Config.USER_TICKET};this.SM.sendMessage(CMD.CLIENT_COMMAND_LOGIN,t)},e.prototype.C_CREATE_ROOM=function(t){this.SM.sendMessage(CMD.CLIENT_COMMAND_CREATE,t),RoomUI.getInstance().roomPattern=!0},e.prototype.C_JOIN_ROOM=function(t){this.SM.sendMessage(CMD.CLIENT_COMMAND_JOIN,t)},e.prototype.C_JOIN_ROOM_QUICK=function(t){this.SM.sendMessage(CMD.CLIENT_COMMAND_QUICK,t)},e.prototype.C_HEART_BEAT=function(){var t=this,e=new Date,i=(e.getTime(),function(){t.SM.sendMessage(CMD.CLIENT_COMMAND_HEART),clearTimeout(t.myHeart),t.myHeart=setTimeout(i,15e3)});clearTimeout(this.myHeart),this.myHeart=setTimeout(i,15e3)},e.prototype.C_LOGOUT_ROOM=function(){this.SM.sendMessage(CMD.CLIENT_COMMAND_EXIT)},e.prototype.C_GET_PREPARED=function(){var t=this;this.SM.sendMessage(CMD.CLIENT_COMMAND_READY,{token:Config.USER_TICKET,openId:Config.USER_OPEN_ID,roomNo:t.curRoomNo})},e.prototype.C_GRAB_BANKER=function(t){this.SM.sendMessage(CMD.CLIENT_COMMAND_BANKER,{bet:t})},e.prototype.C_BET_TIMES=function(t){this.SM.sendMessage(CMD.CLIENT_COMMAND_BET,{bet:t})},e.prototype.C_SEND_CHAT=function(t){this.SM.sendMessage(CMD.CLIENT_COMMAND_CHAT,{type:1,value:0,text:t})},e.prototype.C_SEND_ZHANJI=function(){this.SM.sendMessage(CMD.SERVER_COMMAND_HISTORY,{p:1})},e.prototype.C_SEND_ZhanJiNext=function(t){this.SM.sendMessage(CMD.SERVER_COMMAND_HISTORY,{p:t})},e.prototype.C_SEND_XIANGQING=function(t,e){this.SM.sendMessage(CMD.SERVER_COMMAND_HISTORY_DES,{id:t,p:e})},e.prototype.C_SEND_XiangQingNext=function(t,e){this.SM.sendMessage(CMD.SERVER_COMMAND_HISTORY_DES,{id:t,p:e})},e.prototype.C_SEND_EXIT_ROOM=function(){this.SM.sendMessage(CMD.CLIENT_COMMAND_EXIT)},e.prototype.C_SEND_DISSOLVE_ROOM=function(){this.SM.sendMessage(CMD.CLIENT_COMMAND_DISSOLVEROOM)},e.prototype.C_SEND_VOTE=function(t,e){this.SM.sendMessage(CMD.SERVER_COMMAND_VOTE,{e:t,r:e})},e}(egret.DisplayObjectContainer);GameController._instance=null,__reflect(GameController.prototype,"GameController");var CreateRoomPanel=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.uiCompHandler,e),e.skinName="createRoomPanelSkin",e}return __extends(e,t),e.getInstance=function(){return null==this._instance&&(this._instance=new e),e._instance},e.prototype.uiCompHandler=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.closePanel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeFunc,this),this.buttonCreateRoom.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this.getTypeValue();console.log("%cCreate Room","color:orange",t),t&&(GameController.getInstance().C_CREATE_ROOM(t),this.closeFunc())},this)},e.prototype.closeFunc=function(){console.log("%cClick close","color:orange"),this.parent&&this.parent.removeChild(this)},e.prototype.getTypeValue=function(){switch(this.round=this.numberType1.selected&&Number(this.numberType1.value)||this.numberType0.selected&&Number(this.numberType0.value),this.model=this.bankerType1.selected&&Number(this.bankerType1.value)||this.bankerType2.selected&&Number(this.bankerType2.value),!0){case this.amountType1.selected:this.bet=Number(this.amountType1.value);break;case this.amountType5.selected:this.bet=Number(this.amountType5.value);break;case this.amountType10.selected:this.bet=Number(this.amountType10.value);break;case this.amountType20.selected:this.bet=Number(this.amountType20.value);break;case this.amountType50.selected:this.bet=Number(this.amountType50.value);break;case this.amountType100.selected:this.bet=Number(this.amountType100.value)}if(this.hide=this.findType.selected?1:2,this.round&&this.model&&this.bet){var t={round:this.round,model:this.model,bet:this.bet,hide:this.hide,type:1};return t}return!1},e}(eui.Panel);CreateRoomPanel._instance=null,__reflect(CreateRoomPanel.prototype,"CreateRoomPanel");var JoinRoomPanel=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.uiCompHandler,e),e.skinName="joinRoomPanelSkin",e}return __extends(e,t),e.prototype.uiCompHandler=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.keyboardOK.addEventListener(egret.TouchEvent.TOUCH_TAP,this.joinRoom,this),this.closePanel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeFunc,this),this.keyboardCorrect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickDeleteBtn,this),this.initKeyBoardList(),this.initNumberList()},e.prototype.closeFunc=function(){console.log("%cClick close","color:orange"),!!this.parent&&this.parent.removeChild(this)},e.prototype.initKeyBoardList=function(){var t=this;this.keyboardList.$children.forEach(function(e){"确定"!==e.label&&"删除"!==e.label&&e.addEventListener(egret.TouchEvent.TOUCH_TAP,t.clickKerboardNumber,t)})},e.prototype.initNumberList=function(){this.numCollection=new eui.ArrayCollection;for(var t=0;6>t;t++)this.numCollection.addItem({label:""});var e=new eui.HorizontalLayout;e.gap=10,this.numberList.layout=e,this.numberList.dataProvider=this.numCollection,this.numberList.itemRenderer=NumberItemRenderer},e.prototype.clickKerboardNumber=function(t){var e=this,i=t.target.label;
this.numCollection.source.some(function(t,n){return t.label?void 0:(e.numCollection.replaceItemAt({label:i},n),!0)})},e.prototype.clickDeleteBtn=function(){for(var t=5;t>=0;t--)if(""!=this.numCollection.getItemAt(t).label)return void this.numCollection.replaceItemAt({label:""},t)},e.prototype.joinRoom=function(){for(var t=[],e=0;6>e;e++){var i=this.numCollection.getItemAt(e).label;if(""==i)return void console.log("请输入完整房间号");t.push(i)}var n=t.join(""),o={rId:n};console.log("%cJoin Room","color:green",n),GameController.getInstance().C_JOIN_ROOM(o),this.closeFunc()},e}(eui.Component);__reflect(JoinRoomPanel.prototype,"JoinRoomPanel");var JoinRoomQuickRanel=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.uiCompHandler,e),e.skinName="joinRoomQuickPanelSkin",e}return __extends(e,t),e.getInstance=function(){return null==this._instance&&(this._instance=new e),e._instance},e.prototype.uiCompHandler=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.closePanel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeFunc,this),this.buttonOpenRoom.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this.getTypeValue();console.log("%cJoin Room","color:orange",t),t&&(GameController.getInstance().C_JOIN_ROOM_QUICK(t),this.closeFunc())},this)},e.prototype.getTypeValue=function(){switch(!0){case this.amount1.selected:this.amountValue=this.amount1.value;break;case this.amount5.selected:this.amountValue=this.amount5.value;break;case this.amount10.selected:this.amountValue=this.amount10.value}if(this.amountValue){var t={bet:this.amountValue};return t}return!1},e.prototype.closeFunc=function(){console.log("%cClick close","color:orange"),this.parent&&this.parent.removeChild(this)},e}(eui.Component);JoinRoomQuickRanel._instance=null,__reflect(JoinRoomQuickRanel.prototype,"JoinRoomQuickRanel");var NumberItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="numberItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.numLabel.text=this.data.label},e}(eui.ItemRenderer);__reflect(NumberItemRenderer.prototype,"NumberItemRenderer");var Poker=function(t){function e(e){var i=t.call(this)||this;return i.canSelect=!1,i.isSelect=!1,i.pokerData=e,i.addEventListener(eui.UIEvent.COMPLETE,i.uiCompHandler,i),i.skinName="pokerSkin",i}return __extends(e,t),e.prototype.uiCompHandler=function(){this.initPoker(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getSelected,this)},e.prototype.getSelected=function(){if(this.canSelect)if(this.isBack)SoundManager.playEffect("deal"),this.showFront();else{SoundManager.playEffect("deal"),this.isSelect=!this.isSelect,this.top=this.isSelect?-30:0;var t={selected:this.isSelect,value:this.pokerData.n};RoomUI.getInstance().playerGetCalculate(t)}},e.prototype.getIsSelected=function(){return this.isSelect},e.prototype.setCanSelect=function(t){this.canSelect=t},e.prototype.initPoker=function(){var t=this.getValueStr(),e=this.getSuitStrArr();this.number.source=t,this.suitS.source=e[0],this.pokerData.n<=10?(this.suitX.visible=!0,this.suitF.visible=!1,this.suitX.source=e[1]):(this.suitX.visible=!1,this.suitF.visible=!0,this.suitF.source=e[1]),this.showBack()},e.prototype.getValueStr=function(){var t="",e="";return 4==this.pokerData.suit||2==this.pokerData.suit?t="red_":(3==this.pokerData.suit||1==this.pokerData.suit)&&(t="black_"),e=t+this.pokerData.n},e.prototype.getSuitStrArr=function(){var t="",e="",i="",n="",o=[];switch(this.pokerData.suit){case 4:t="diamond_";break;case 2:t="heart_";break;case 3:t="club_";break;case 1:t="spade_"}switch(e=t+"s",o.push(e),this.pokerData.n){case 11:n=t+"jack",o.push(n);break;case 12:n=t+"queen",o.push(n);break;case 13:n=t+"king",o.push(n);break;default:i=t+"x",o.push(i)}return o},e.prototype.showBack=function(){this.isBack=!0,this.front.visible=!1,this.back.visible=!0},e.prototype.showFront=function(){this.isBack=!1,this.front.visible=!0,this.back.visible=!1},e.prototype.setScaled=function(t){this.scaleX=t,this.scaleY=t},e.prototype.resetPos=function(){this.isSelect=!1,this.top=0},e}(eui.Component);__reflect(Poker.prototype,"Poker");var DealPoker=function(t){function e(e,i){var n=t.call(this)||this;return n.noEnd=0,n.data=e,n.cb=i,n.addEventListener(eui.UIEvent.COMPLETE,n.uiCompHandler,n),n.skinName="dealPokerSkin",n}return __extends(e,t),e.prototype.uiCompHandler=function(){for(var t=this,e=0;e<this.data.length;e++){this.noEnd++;var i=this.createPoker();this.addChild(i);var n=this.data[e][0],o=this.data[e][1],r=this.pokerSeat(n,o),s=this.getCardScale(n);egret.Tween.get(i).wait(150*e).to({x:r[0],y:r[1],scaleX:s,scaleY:s,rotation:0},300).call(function(){SoundManager.playEffect("deal"),t.noEnd--,t.callMyFunc()})}},e.prototype.getCardScale=function(t){var e;return e=0==t?1.2:.8},e.prototype.createPoker=function(){var t=new eui.Image;return t.source="poker_back",t.x=982,t.y=569,t.rotation=180,t.scaleX=.3,t.scaleY=.3,t},e.prototype.callMyFunc=function(){var t=this;!this.noEnd&&this.cb&&setTimeout(function(){t.cb()},500)},e.prototype.setScale=function(t){this.img_poker.scaleX=t,this.img_poker.scaleY=t},e.prototype.pokerSeat=function(t,e){var i=[[[530.6,820.6],[698.6,820.6],[866.6,820.6],[1034.6,820.6],[1202.6,820.6]],[[86.4,626.4],[124.4,626.4],[162.4,626.4],[200.4,626.4],[238.4,626.4]],[[581.4,111.4],[619.4,111.4],[657.4,111.4],[695.4,111.4],[733.4,111.4]],[[1071.4,111.4],[1109.4,111.4],[1147.4,111.4],[1185.4,111.4],[1223.4,111.4]],[[1576.4,626.4],[1614.4,626.4],[1652.4,626.4],[1690.4,626.4],[1728.4,626.4]]],n=i[t][e];return n},e}(eui.Component);__reflect(DealPoker.prototype,"DealPoker");var Player=function(t){function e(e){var i=t.call(this)||this;return i.banker=!1,i.grabBanker=!1,i.hadBet=!1,i.cardType=0,i.removeChildren(),i.data=e,i.data?(i.setPosId(),i.initPlayer(),i.initSeat(),i.initChatPop(),i):i}return __extends(e,t),e.prototype.initPlayer=function(){var t=[];t=SeatManager.getInstance().getPlayerRect(this.data.pos),this.width=t[0],this.height=t[1];var e=[];e=SeatManager.getInstance().getPlayerPos(this.data.pos),this.horizontalCenter=e[0],this.verticalCenter=e[1]},e.prototype.initSeat=function(){var t=[];t=SeatManager.getInstance().getSeatPos(this.data.pos),this.seat=new PlayerSeat,this.seat.left=t[0],this.seat.top=t[1],this.addChild(this.seat),this.seat.setPlayerInfo(this.data.nickname,this.data.avatar,this.data.score),1==this.data.status&&this.setPrepared()},e.prototype.setPrepared=function(){this.seat.preparedOK.visible=!0},e.prototype.updateScore=function(t){this.seat.updateScore(t)},e.prototype.hidePrepared=function(){this.seat.preparedOK.visible=!1},e.prototype.showGrabBanker=function(){this.seat.playerLight.visible=!0},e.prototype.hideGrabBanker=function(){this.seat.playerLight.visible=!1},e.prototype.setGrabBankerStatus=function(t){this.seat.setGrabBankerStatus(t)},e.prototype.setBanker=function(t){this.banker=t},e.prototype.getBanker=function(){return this.banker},e.prototype.showBanker=function(){this.seat.banker.visible=!0},e.prototype.hideBanker=function(){this.seat.banker.visible=!1},e.prototype.dealHandCards=function(t){if(this.data.handCards=t,this.data.handCards){this.handCards&&this.handCards.parent&&this.handCards.parent.removeChild(this.handCards);var e=0==this.posId?1.2:.8,i=0==this.posId?-30:100,n=this.getCardsEndPos(this.posId),o={cardsScale:e,cardsGap:i,cardsEndPos:n};this.handCards=new PlayerHandCards(this.data.handCards,o),this.handCards.x=150,this.handCards.y=100,this.addChild(this.handCards)}},e.prototype.getCardsEndPos=function(t){var e=[];switch(t){case 0:e[0]=50,e[1]=-70;break;case 1:e[0]=-120,e[1]=170;break;case 2:e[0]=50,e[1]=-20;break;case 3:e[0]=-160,e[1]=-20;break;case 4:e[0]=-30,e[1]=170;break;default:e[0]=0,e[1]=0}return e},e.prototype.showMyThreeCards=function(){this.handCards&&this.handCards.showThree()},e.prototype.showMyFourCards=function(){this.handCards&&this.handCards.showFour()},e.prototype.showMyAllCards=function(){this.handCards&&this.handCards.showCardsFront()},e.prototype.setMyCardsCanSelect=function(){this.handCards&&this.handCards.setCardsCanSelect()},e.prototype.setMyCardsCannotSelect=function(){this.handCards&&this.handCards.setMyCardsCannotSelect()},e.prototype.checkMyHandCards=function(){this.handCards&&this.handCards.setCardsCannotSelect()},e.prototype.resetMyCards=function(){this.handCards.resetCards()},e.prototype.removeCards=function(){this.handCards&&this.handCards.parent&&(this.handCards.parent.removeChild(this.handCards),this.handCards=null)},e.prototype.addTips=function(t){var e=[];e=SeatManager.getInstance().getBetPos(this.data.pos),this.tipWords=new eui.Image,this.tipWords.source=t,this.tipWords.horizontalCenter=e[0],this.tipWords.verticalCenter=e[1],this.applyGlowFilter(this.tipWords,13871436),this.addChild(this.tipWords)},e.prototype.addBullTips=function(t){var e=[];e=SeatManager.getInstance().getBullPos(this.data.pos),this.bullTipGroup=new eui.Group,this.bullTipGroup.horizontalCenter=e[0],this.bullTipGroup.verticalCenter=e[1],SeatManager.getInstance().getPosId(this.data.pos)&&(this.bullTipGroup.scaleX=.5,this.bullTipGroup.scaleY=.5),this.bullTipBg=new eui.Image,this.bullTipBg.source="v2_tips_note_bg",this.bullTipBg.y=60,this.bullTipGroup.addChild(this.bullTipBg),this.bullTipWords=new eui.Image,this.bullTipWords.source=t,this.bullTipWords.rotation=-5,this.bullTipGroup.addChild(this.bullTipWords),this.addChild(this.bullTipGroup)},e.prototype.addBetTips=function(t){var e=[];e=SeatManager.getInstance().getBetPos(this.data.pos),this.betTipGroup=new eui.Group,this.betTipGroup.horizontalCenter=e[0],this.betTipGroup.verticalCenter=e[1],this.betTipGroup.scaleX=2,this.betTipGroup.scaleY=2,this.betTipWordsX=new eui.Image,this.betTipWordsX.source="num_d_x",this.applyGlowFilter(this.betTipWordsX,65280),this.betTipGroup.addChild(this.betTipWordsX),this.betTipWordsN=new eui.Image,this.betTipWordsN.source=t,this.betTipWordsN.x=25,this.applyGlowFilter(this.betTipWordsN,65280),this.betTipGroup.addChild(this.betTipWordsN),this.addChild(this.betTipGroup)},e.prototype.setGrabBanker=function(t){this.grabBanker=t},e.prototype.getGrabBanker=function(){return this.grabBanker},e.prototype.setHadBet=function(t){this.hadBet=t},e.prototype.getHadBet=function(){return this.hadBet},e.prototype.showTips=function(t,e,i){i=i!==!1?!0:!1;var n=!0,o="";switch(t){case"times":if(i&&SoundManager.playEffect("bet"),e=e.substr(1),"0"==e)return;this.showBetTips(e),n=!1;break;case"banker":i&&SoundManager.playEffect("bet"),o=e?"v2_tip_times_X"+String(e):"v2_tips_buqiang",this.data.bet=parseInt(e);break;case"note":i&&this.playerSoundEffect(e),this.showBullTips(e),n=!1}n&&(this.hideBetTips(),this.hideTips(),this.tipWords&&this.tipWords.parent?(this.tipWords.source=o,this.tipWords.visible=!0,this.setChildIndex(this.tipWords,10)):this.addTips(o))},e.prototype.showBullTips=function(t){var e="v2_tips_note_"+t;this.bullTipGroup&&this.bullTipGroup.parent?(this.bullTipWords.source=e,this.bullTipGroup.visible=!0,this.setChildIndex(this.bullTipGroup,10)):this.addBullTips(e),"0"==t?(this.bullTipBg.visible=!1,this.bullTipWords.rotation=0):(this.bullTipBg.visible=!0,this.bullTipWords.rotation=-5)},e.prototype.showBetTips=function(t){var e="num_d_"+t;this.betTipGroup&&this.betTipGroup.parent?(this.hideBetTips(),this.betTipWordsN.source=e,this.betTipGroup.visible=!0,this.setChildIndex(this.betTipGroup,10)):this.addBetTips(e)},e.prototype.playerSoundEffect=function(t){var e=["1","2","3","4","5","6","7","8","9"];switch(-1!==e.indexOf(t)&&SoundManager.playEffect("bull_"+t),t){case"0":SoundManager.playEffect("no_bull");break;case"10":SoundManager.playEffect("bull_bull");break;case"11":case"12":SoundManager.playEffect("bull_flower");break;case"13":SoundManager.playEffect("bull_little");break;case"14":SoundManager.playEffect("bull_boom")}},e.prototype.hideTips=function(){this.tipWords&&(this.tipWords.visible=!1)},e.prototype.hideBullTips=function(){this.bullTipGroup&&(this.bullTipGroup.visible=!1)},e.prototype.hideBetTips=function(){this.betTipGroup&&(this.betTipGroup.visible=!1)},e.prototype.getSeatId=function(){return this.data.pos},e.prototype.setPosId=function(){this.posId=SeatManager.getInstance().getPosId(this.data.pos)},e.prototype.getPosId=function(){return this.posId},e.prototype.getOpenId=function(){return this.data.uid},e.prototype.setCardType=function(t){this.cardType=t},e.prototype.getCardType=function(){return this.cardType},e.prototype.initChatPop=function(){this.chatPop=new PlayerChatPop,this.addChild(this.chatPop);var t=SeatManager.getInstance().getChatPos(this.posId);this.chatPop.left=t[0],this.chatPop.top=t[1]},e.prototype.showChatPop=function(t){this.chatPop&&this.chatPop.show(t)},e.prototype.reset=function(){this.hideBanker(),this.hideGrabBanker(),this.hideTips(),this.hideBullTips(),this.hideBetTips(),this.removeCards(),this.setBanker(!1),this.setHadBet(!1),this.setGrabBanker(!1)},e.prototype.applyGlowFilter=function(t,e){var e=e,i=.5,n=15,o=15,r=1,s=3,a=!1,l=!1,h=new egret.GlowFilter(e,i,n,o,r,s,a,l);t.filters=[h]},e}(eui.ItemRenderer);__reflect(Player.prototype,"Player");var PlayerChatPop=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.uiCompHandler,e),e.skinName="playerChatPopSkin",e}return __extends(e,t),e.prototype.uiCompHandler=function(){this.initChat()},e.prototype.initChat=function(){this.chatBg.ellipseWidth=20,this.chatBg.ellipseHeight=20,this.visible=!1},e.prototype.show=function(t){var e=this;this.visible=!0,this.chatLabel.text=t,this.chatBg.width=this.chatLabel.width+20,setTimeout(function(){e.hide()},4e3)},e.prototype.hide=function(){this.chatLabel.text="",this.visible=!1},e}(eui.Component);__reflect(PlayerChatPop.prototype,"PlayerChatPop");var PlayerHandCards=function(t){function e(e,i){var n=t.call(this)||this;return n.cardsArr=e,n.cardsInfo=i,n.pokerList=[],n.cardsList=new eui.Group,n.addChild(n.cardsList),n.addCards(),window.PlayerHandCards2=n,n}return __extends(e,t),e.prototype.addCards=function(){console.log("addCards----",this.cardsArr,this.cardsInfo);var t=this.cardsInfo.cardsGap,e=this.cardsInfo.cardsEndPos;this.cardsList.left=e[0],this.cardsList.top=e[1];for(var i=this.cardsArr.length,n=0;i>n;n++){var o=new Poker(this.cardsArr[n]);o.setScaled(this.cardsInfo.cardsScale),o.left=(o.width-t)*n,o.top=0,this.pokerList.push(o),this.cardsList.addChild(o)}},e.prototype.resetCards=function(){for(var t=this.pokerList.length,e=0;t>e;e++){var i=this.pokerList[e];i.resetPos()}},e.prototype.showThree=function(){for(var t=0;3>t;t++){var e=this.pokerList[t];e.showFront()}},e.prototype.showFour=function(){for(var t=0;4>t;t++){var e=this.pokerList[t];e.showFront()}},e.prototype.showCardsFront=function(){for(var t=this.pokerList.length,e=0;t>e;e++){var i=this.pokerList[e];i.showFront()}},e.prototype.showCardsBack=function(){for(var t=this.pokerList.length,e=0;t>e;e++){var i=this.pokerList[e];i.showBack()}},e.prototype.setCardsCanSelect=function(){for(var t=this.pokerList.length,e=0;t>e;e++){var i=this.pokerList[e];i.setCanSelect(!0)}},e.prototype.setMyCardsCannotSelect=function(){for(var t=this.pokerList.length,e=0;t>e;e++){var i=this.pokerList[e];i.setCanSelect(!1)}},e.prototype.setCardsCannotSelect=function(){for(var t=this.pokerList.length,e=0,i=0;t>i;i++){var n=this.pokerList[i];n.getIsSelected()&&e++}e>=3?this.setPokerCannotSelect():this.setCardsCanSelect()},e.prototype.setPokerCannotSelect=function(){for(var t=this.pokerList.length,e=0;t>e;e++){var i=this.pokerList[e];i.getIsSelected()||i.setCanSelect(!1)}},e}(eui.Component);__reflect(PlayerHandCards.prototype,"PlayerHandCards");var PlayerSeat=function(t){function e(){var e=t.call(this)||this;return e.skinName="playerSeatSkin",e}return __extends(e,t),e.prototype.setPlayerInfo=function(t,e,i){this.playerNikename.text=t,this.playerScore.text=i,this.playerAvatar.source=e,this.playerAvatar.mask=this.rect_mask},e.prototype.setGrabBankerStatus=function(t){t?this.playerStatus.source="icon_circle_red":this.playerStatus.source="icon_circle_gray"},e.prototype.updateScore=function(t){console.log("score",t),this.playerScore.text=String(t)},e}(eui.Component);__reflect(PlayerSeat.prototype,"PlayerSeat");var SeatManager=function(){function t(){this.stageW=1920,this.stageH=1080}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),t.instance},t.prototype.setMySeatId=function(t){this.mySeatId=Number(t)},t.prototype.setSeatId=function(t){this.seatId=Number(t)},t.prototype.setPosId=function(t){t=Number(t),this.pos=(t-1+(5-(this.mySeatId-1)))%5},t.prototype.getPosId=function(t){return this.setPosId(t),this.pos},t.prototype.getPlayerRect=function(t){var e=[];return this.setPosId(t),0==this.pos?(e[0]=1250,e[1]=230):1==this.pos||4==this.pos?(e[0]=400,e[1]=500):(2==this.pos||3==this.pos)&&(e[0]=450,e[1]=230),e},t.prototype.getPlayerPos=function(t){var e=[];switch(this.setPosId(t),this.pos){case 0:e[0]=0,e[1]=this.stageH/2-170;break;case 1:e[0]=-(this.stageW/2)+260,e[1]=70;break;case 2:e[0]=-350,e[1]=-(this.stageH/2)+150;break;case 3:e[0]=350,e[1]=-(this.stageH/2)+150;break;case 4:e[0]=this.stageW/2-260,e[1]=70;break;default:e[0]=0,e[1]=0}return e},t.prototype.getSeatPos=function(t){var e=[];return this.setPosId(t),3==this.pos?(e[0]=250,e[1]=0):4==this.pos?(e[0]=200,e[1]=0):(e[0]=0,e[1]=0),e},t.prototype.getBullPos=function(t){var e=[];switch(this.setPosId(t),this.pos){case 0:e[0]=-50,e[1]=40;break;case 1:e[0]=-50,e[1]=150;break;case 2:e[0]=100,e[1]=90;break;case 3:e[0]=-100,e[1]=90;break;case 4:e[0]=50,e[1]=150}return e},t.prototype.getBetPos=function(t){var e=[];switch(this.setPosId(t),this.pos){case 0:e[0]=-680,e[1]=-20;break;case 1:e[0]=50,e[1]=-20;break;case 2:e[0]=40,e[1]=-80;break;case 3:e[0]=-40,e[1]=-80;break;case 4:e[0]=-50,e[1]=-20}return e},t.prototype.getChatPos=function(t){var e=[];switch(t){case 0:e[0]=30,e[1]=-40;break;case 1:e[0]=200,e[1]=100;break;case 2:e[0]=30,e[1]=240;break;case 3:e[0]=-10,e[1]=240;break;case 4:e[0]=-150,e[1]=100}return e},t.prototype.getCoinPos=function(t){var e=[];switch(this.setPosId(t),this.pos){case 0:e[0]=353,e[1]=990;break;case 1:e[0]=78,e[1]=555;break;case 2:e[0]=403,e[1]=230;break;case 3:e[0]=1353,e[1]=230;break;case 4:e[0]=1678,e[1]=555}return e},t}();SeatManager.instance=null,__reflect(SeatManager.prototype,"SeatManager");var StartGame=function(t){function e(e,i){var n=t.call(this)||this;return n.param=null,n.cb=null,n.addEventListener(eui.UIEvent.COMPLETE,n.uiCompHandler,n),n.skinName="startGameSkin",n.param=e,n.cb=i,n}return __extends(e,t),e.prototype.uiCompHandler=function(){SoundManager.playEffect("start")},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.tgpStart.addEventListener("complete",this.onTweenGroupComplete,this),this.tgpStart.play()},e.prototype.onTweenGroupComplete=function(){this.parent&&this.parent.removeChild(this),this.param,this.cb&&this.cb()},e}(eui.Component);__reflect(StartGame.prototype,"StartGame");var TimeOutClock=function(t){function e(){var e=t.call(this)||this;return e.skinName="timeOutClockSkin",e}return __extends(e,t),e.prototype.runTimeOut=function(t,e){function i(){return n.curTime--,console.log("curTime",this.curTime),n.curTime<=5&&SoundManager.playEffect("daojishi"),n.timeLabel.text=n.curTime.toString(),n.curTime<=0?(clearTimeout(n.myTime),void o()):(clearTimeout(n.myTime),void(n.myTime=setTimeout(i.bind(n),1e3)))}this.curTime=t,this.timeLabel.text=t.toString();var n=this,o=e?e:function(){};clearTimeout(this.myTime),this.myTime=setTimeout(i,1e3)},e.prototype.clearTimeOut=function(){this.myTime&&(clearTimeout(this.myTime),this.myTime=null)},e}(eui.Component);__reflect(TimeOutClock.prototype,"TimeOutClock");var UserControlBar=function(t){function e(){var e=t.call(this)||this;return e.numberArr=[],e.addEventListener(eui.UIEvent.COMPLETE,e.uiCompHandler,e),e.skinName="userControlBarSkin",e}return __extends(e,t),e.prototype.uiCompHandler=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.removeEvents(),this.bindBullBar(),this.bindTimesBar(),this.bindBankerBar(),this.buttonPrepare.addEventListener(egret.TouchEvent.TOUCH_TAP,this.getReady,this)},e.prototype.getReady=function(){var t=RoomUI.getInstance();t.hideClock(),SoundManager.playEffect("tap"),GameController.getInstance().C_GET_PREPARED(),t.playerPrepared(null),this.buttonPrepare.visible=!1},e.prototype.removeEvents=function(){this.removeBindTimesBar(),this.buttonPrepare.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.getReady,this)},e.prototype.hideAll=function(){this.buttonPrepare.visible=!1,this.timesBar.visible=!1,this.bankersBar.visible=!1,this.bullBar.visible=!1,this.calculateBar.visible=!1},e.prototype.showPrepare=function(){this.enabled=!0,this.buttonPrepare.visible=!0},e.prototype.showTimesBar=function(){this.hideAll(),this.enabled=!0,this.timesBar.visible=!0,this.timesBar.$children.forEach(function(t){t.visible=!0})},e.prototype.bindTimesBar=function(){var t=this;this.buttonTime1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickTimesBarFunc(e.target.label)},this),this.buttonTime2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickTimesBarFunc(e.target.label)},this),this.buttonTime3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickTimesBarFunc(e.target.label)},this),this.buttonTime4.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickTimesBarFunc(e.target.label)},this),this.buttonTime5.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickTimesBarFunc(e.target.label)},this)},e.prototype.removeBindTimesBar=function(){var t=this;this.buttonTime1.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickTimesBarFunc(e.target.label)},this),this.buttonTime2.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickTimesBarFunc(e.target.label)},this),this.buttonTime3.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickTimesBarFunc(e.target.label)},this),this.buttonTime4.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickTimesBarFunc(e.target.label)},this),this.buttonTime5.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickTimesBarFunc(e.target.label)},this)},e.prototype.clickTimesBarFunc=function(t){SoundManager.playEffect("tap");var e=t.split("")[0];GameController.getInstance().C_BET_TIMES(e),this.hideAll();var i={timesNo:e};RoomUI.getInstance().playerChooseTimes(i)},e.prototype.showBankersBar=function(t){this.hideAll(),this.enabled=!0,this.bankersBar.visible=!0,(t||0===t)&&(0>=t?(this.buttonBanker5.visible=!0,this.buttonBanker4.visible=!0,this.buttonBanker3.visible=!0,this.buttonBanker2.visible=!0,this.buttonBanker1.visible=!0,this.buttonBanker0.visible=!0):1>=t?(this.buttonBanker5.visible=!0,this.buttonBanker4.visible=!0,this.buttonBanker3.visible=!0,this.buttonBanker2.visible=!0,this.buttonBanker1.visible=!0,this.buttonBanker0.visible=!0):2>=t?(this.buttonBanker5.visible=!0,this.buttonBanker4.visible=!0,this.buttonBanker3.visible=!0,this.buttonBanker2.visible=!0,this.buttonBanker1.visible=!0,this.buttonBanker0.visible=!0):3>=t?(this.buttonBanker5.visible=!0,this.buttonBanker4.visible=!0,this.buttonBanker3.visible=!0,this.buttonBanker2.visible=!0,this.buttonBanker1.visible=!0,this.buttonBanker0.visible=!0):4>=t?(this.buttonBanker5.visible=!0,this.buttonBanker4.visible=!0,this.buttonBanker3.visible=!0,this.buttonBanker2.visible=!0,this.buttonBanker1.visible=!0,this.buttonBanker0.visible=!0):5>=t&&(this.buttonBanker5.visible=!0,this.buttonBanker4.visible=!0,this.buttonBanker3.visible=!0,this.buttonBanker2.visible=!0,this.buttonBanker1.visible=!0,this.buttonBanker0.visible=!0))},e.prototype.bindBankerBar=function(){var t=this;this.buttonBanker0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(0)},this),this.buttonBanker1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(1)},this),this.buttonBanker2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(2)},this),this.buttonBanker3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(3)},this),this.buttonBanker4.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(4)},this),this.buttonBanker5.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(5)},this)},e.prototype.removeBindBankerBar=function(){var t=this;this.buttonBanker0.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(0)},this),this.buttonBanker1.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(1)},this),this.buttonBanker2.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(2)},this),this.buttonBanker3.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(3)},this),this.buttonBanker4.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(4)},this),this.buttonBanker5.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.clickBankerBarFunc(5)},this)},e.prototype.clickBankerBarFunc=function(t){SoundManager.playEffect("tap"),GameController.getInstance().C_GRAB_BANKER(t),this.hideAll();var e={timesNo:t};RoomUI.getInstance().playerGrabBanker(e)},e.prototype.showBullBar=function(){this.enabled=!0,this.bullBar.visible=!0,this.showBtnNoBull()},e.prototype.showBtnBull=function(){this.enabled=!0,this.buttonBull.visible=!0,this.buttonNoBull.visible=!1},e.prototype.showBtnNoBull=function(){this.enabled=!0,this.buttonBull.visible=!1,this.buttonNoBull.visible=!0},e.prototype.bindBullBar=function(){var t=RoomUI.getInstance();this.buttonBull.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){SoundManager.playEffect("tap"),t.resetPokers(),t.checkBull(!0)},this),this.buttonNoBull.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){SoundManager.playEffect("tap"),t.resetPokers(),t.checkBull(!1)},this)},e.prototype.showCalculateBar=function(){this.calculateBar.visible=!0,this.resetCalculateValue()},e.prototype.setCalculateValue=function(t,e){var i=this.numberArr.indexOf(e),n=this.numberArr.length;"plus"==t?3>n&&this.numberArr.push(e):"minus"==t&&-1!=i&&this.numberArr.splice(i,1),this.setCalculateLabel()},e.prototype.resetCalculateValue=function(){this.numberArr=[],this.setCalculateLabel()},e.prototype.getCalculateLabel=function(t){switch(t){case 0:return this.numLabel1;case 1:return this.numLabel2;case 2:return this.numLabel3;default:return this.numLabel1}},e.prototype.setCalculateLabel=function(){for(var t=0,e=(this.numberArr.length,0),i=0;3>i;i++){var n=this.numberArr[i];n&&n>10&&(n=10);var o=this.getCalculateLabel(i);o.text=n&&0!=n?n.toString():"",""!=o.text&&e++,t+=n?n:0,this.numLabelTotal.text=0!=t?t.toString():""}3==e&&0!=t&&t%10==0?this.showBtnBull():this.showBtnNoBull()},e}(eui.Component);__reflect(UserControlBar.prototype,"UserControlBar");var RoomChatPanel=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.uiCompHandler,e),e.skinName="roomChatPanelSkin",e}return __extends(e,t),e.prototype.uiCompHandler=function(){this.textChat.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.clearText,this),this.textChat.addEventListener(egret.Event.CHANGE,this.resetText,this),this.panelBg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeFunc,this),this.buttonChat.addEventListener(egret.TouchEvent.TOUCH_TAP,this.submitChat,this),this.initChatList()},e.prototype.closeFunc=function(){this.visible=!1,this.enabled=!1,this.inputLabel.visible=!0},e.prototype.clearText=function(){this.inputLabel.visible=!1},e.prototype.resetText=function(){""==this.textChat.text?this.inputLabel.visible=!0:(this.inputLabel.visible=!1,this.textChat.text.length>=30&&(this.textChat.text=this.textChat.text.slice(0,30)))},e.prototype.submitChat=function(){return""==this.textChat.text?(this.inputLabel.visible=!0,void PageLayer.getInstance().showTips("请输入聊天内容")):(SoundManager.playEffect("tap"),GameController.getInstance().C_SEND_CHAT(this.textChat.text),void this.closeFunc())},e.prototype.initChatList=function(){this.chatListData=new eui.ArrayCollection,this.chatListData.addItem({chatStr:"别吵了别吵了，专心玩游戏吧！"}),this.chatListData.addItem({chatStr:"哈哈，这把你要惨了！"}),this.chatListData.addItem({chatStr:"快点吧，不要耽误我赢钱！"}),this.chatListData.addItem({chatStr:"快点吧，一会儿飞机都要起飞了！"}),this.chatListData.addItem({chatStr:"快点快点，这把我要通杀！"}),this.chatListData.addItem({chatStr:"你是哪里的，我们交个朋友吧！"}),this.chatListData.addItem({chatStr:"什么网啊，那么慢！"});var t=new eui.VerticalLayout;t.gap=5,this.chatList.layout=t,this.chatList.dataProvider=this.chatListData,this.chatList.itemRenderer=ChatItemRenderer},e}(eui.Panel);__reflect(RoomChatPanel.prototype,"RoomChatPanel");var ChatItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.uiCompHandler,e),e.skinName="baseChatItemSkin",e}return __extends(e,t),e.prototype.uiCompHandler=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendShortChat,this)},e.prototype.dataChanged=function(){this.chatLabel.text=this.data.chatStr},e.prototype.sendShortChat=function(){SoundManager.playEffect("tap"),GameController.getInstance().C_SEND_CHAT(this.data.chatStr),RoomUI.getInstance().hideChatPannel()},e}(eui.ItemRenderer);__reflect(ChatItemRenderer.prototype,"ChatItemRenderer");var TipsComponent=function(t){function e(){var e=t.call(this)||this;return e.tipW=700,e.tipH=120,e.stageW=1920,e.stageH=1080,e.width=e.stageW,e.height=e.stageH,e.horizontalCenter=0,e.verticalCenter=0,e.createTipsGroup(),e}return __extends(e,t),e.prototype.createTipsGroup=function(){this.bgGroup=new eui.Group,this.bgGroup.width=this.tipW,this.bgGroup.height=this.tipH,this.bgGroup.x=this.stageW/2-this.tipW/2,this.bgGroup.y=this.stageH/2-this.tipH/2,this.addChild(this.bgGroup);var t=new eui.Rect;t.fillAlpha=.5,t.width=this.tipW,t.height=this.tipH,t.horizontalCenter=0,t.verticalCenter=0,t.ellipseWidth=30,t.ellipseHeight=30,this.rect=t,this.bgGroup.addChild(this.rect),this.tipsLabel=new eui.Label,this.tipsLabel.textColor=16777215,this.tipsLabel.size=38,this.tipsLabel.horizontalCenter=0,this.tipsLabel.verticalCenter=0,this.bgGroup.addChild(this.tipsLabel)},e.prototype.setTipsText=function(t){this.tipsLabel.text=t,this.rect.width=30*this.tipsLabel.text.length+200},e}(eui.Component);__reflect(TipsComponent.prototype,"TipsComponent");var detailsList=function(t){function e(){var e=t.call(this)||this;return e.skinName="detailsListSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=t.player,i=t.round,n=t.time;this.num.text=i,this.date.text=Utils.timeToDate(n);for(var o=0;o<e.length;o++){var r=Object.assign({},this.data.player[o],Utils.formatting(e[o])),s=r.bet,a=r.banker,l=r.nickname,h=r.result,c=r.score,u=r.p,p=r.resultColor,d=r.scoreColor,g=r.isSelf;this.height=100*(o+2)+30,this.rec.height=100*(o+1)+30,this["group_"+o].visible=!0,this["group_"+o].getElementAt(0).visible=a,this["group_"+o].getElementAt(1).text=l,this["group_"+o].getElementAt(3).text=s,this["group_"+o].getElementAt(5).text=h,this["group_"+o].getElementAt(5).textColor=p,this["group_"+o].getElementAt(6).text=c,this["group_"+o].getElementAt(6).textColor=d,this.Self.getElementAt(o+1).visible=g;for(var m=0;5>m;m++)if(u&&u.length){var f=new PokerMin(u[m]);f.scaleX=.55,f.scaleY=.55,f.x=85*m+5,this["group_"+o].getElementAt(4).addChild(f)}}},e}(eui.ItemRenderer);__reflect(detailsList.prototype,"detailsList");var recentRecord=function(t){function e(e){var i=t.call(this)||this;return i.i=1,i.recordData=e.d.l,i.addEventListener(eui.UIEvent.COMPLETE,i.uiCompHandler,i),i.skinName="recentRecordSkin",i}return __extends(e,t),e.getInstance=function(t){return e._instance?e._instance.reEnter(t):e._instance=new e(t),e._instance},e.prototype.uiCompHandler=function(){this.initList(),this.scor(),this.backToHall.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.visible=!1,this.enabled=!1,this.ClearStatus()},this)},e.prototype.initList=function(){var t=new eui.VerticalLayout;
t.gap=20,console.log("this.recordData",this.recordData),0===this.recordData.length&&(this.noRecordText.visible=!0,console.log("ok"));var e=this.recordData?this.recordData:[],i=new eui.ArrayCollection(e);this.recordList.layout=t,this.recordList.dataProvider=i,this.recordList.itemRenderer=roomList},e.prototype.scor=function(){var t=this,e=new eui.Scroller;this.Scroller=e,e.viewport=this.recordList,e.x=135,e.y=200,e.width=1600,e.height=770;var i=!0;e.addEventListener(egret.Event.CHANGE,function(n){e.viewport.scrollV+e.height>e.viewport.contentHeight&&i&&(console.log("到底部啦 加载下一页"),i=!1,t.scrollheight=e.viewport.scrollV,GameController.getInstance().C_SEND_ZhanJiNext(++t.i),egret.setTimeout(function(){i=!0},t,2e3))},e),this.addChild(e)},e.prototype.reEnter=function(t){this.recordData!=t&&(this.recordData=t.d.l,this.recordList.dataProvider=new eui.ArrayCollection(t.d.l)),this.visible=!0,this.enabled=!0},e.prototype.NextRecord=function(t){var e=this;0!=t.d.l.length?(this.recordData=this.recordData.concat(t.d.l),this.recordList.dataProvider=new eui.ArrayCollection(this.recordData),egret.setTimeout(function(){e.Scroller.viewport.scrollV=e.scrollheight,console.log("this.scrollheight",e.scrollheight)},this,500)):console.log("没有记录了")},e.prototype.ClearStatus=function(){this.i=1,this.scrollheight=0},e}(eui.Component);__reflect(recentRecord.prototype,"recentRecord");var recordDetails=function(t){function e(e){var i=t.call(this)||this;return i.i=1,i.recordData=e.d.l,i.addEventListener(eui.UIEvent.COMPLETE,i.uiCompHandler,i),i.skinName="recordDetailsSkin",console.log("rec",i.recordData),i}return __extends(e,t),e.getInstance=function(t){return e._instance?e._instance.reEnter(t):(console.log("getInstance"),e._instance=new e(t)),e._instance},e.prototype.uiCompHandler=function(){var t=this;this.initList(),this.backToRecord.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.visible=!1,t.enabled=!1,t.ClearStatus(),t.parent.removeChild(t)},this)},e.prototype.initList=function(){var t=new eui.VerticalLayout;t.gap=20;var e=this.recordData?this.recordData:[],i=new eui.ArrayCollection(e);this.recordList.layout=t,this.recordList.dataProvider=i,this.recordList.itemRenderer=detailsList,this.scor()},e.prototype.reEnter=function(t){console.log("reEnter"),this.recordData!=t&&(console.log("qwewiououi",this.recordData,t),this.recordData=t.d,this.recordList.dataProvider=new eui.ArrayCollection(t.d)),this.visible=!0,this.enabled=!0},e.prototype.scor=function(){var t=this,e=new eui.Scroller;this.Scroller=e,e.viewport=this.recordList,e.x=160,e.y=194,e.width=1600,e.height=770;var i=!0;e.addEventListener(egret.Event.CHANGE,function(n){e.viewport.scrollV+e.height>e.viewport.contentHeight&&i&&(console.log("到底部啦 加载下一页"),i=!1,t.scrollheight=e.viewport.scrollV,GameController.getInstance().C_SEND_XiangQingNext(recentRecord._instance.roomid,++t.i),egret.setTimeout(function(){i=!0},t,2e3))},e),this.addChild(e)},e.prototype.NextRecord=function(t){var e=this;0!=t.d.l.length?(this.recordData=this.recordData.concat(this.deleteRepeat(t)),console.log("this.recordData",this.recordData),this.recordList.dataProvider=new eui.ArrayCollection(this.recordData),egret.setTimeout(function(){e.Scroller.viewport.scrollV=e.scrollheight,console.log("this.scrollheight",e.scrollheight)},this,500)):console.log("没有记录了")},e.prototype.deleteRepeat=function(t){var e=[];this.recordData.map(function(t,i,n){e.push(t.round)});var i=t.d.l.filter(function(t,i,n){return-1===e.indexOf(t.round)});return i=i.filter(function(t,i,n){return e.every(function(e,i,n){return e!==t.round})?(e.push(t.round),!0):void 0})},e.prototype.ClearStatus=function(){this.i=1,this.scrollheight=0,recentRecord._instance.roomid=1,e._instance=null},e}(eui.Component);__reflect(recordDetails.prototype,"recordDetails");var ResultItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="resultItemRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=Object.assign({},this.data,Utils.formatting(this.data)),e=t.isSelf,i=t.bet,n=t.banker,o=t.nickname,r=t.result,s=t.score,a=t.p,l=t.resultColor,h=t.scoreColor;this.bet.text=i,this.nickname.text=o,this.img_banker.visible=n,this.bg.visible=e,this.lb_score.text=s,this.lb_score.textColor=h,this.lb_type.text=r,this.lb_type.textColor=l;for(var c=0;5>c;c++)if(a){var u=new PokerMin(a[c]);u.scaleX=.4,u.scaleY=.4,u.x=60*c+5,this.gp_poker.addChild(u)}},e}(eui.ItemRenderer);__reflect(ResultItemRenderer.prototype,"ResultItemRenderer");var ResultList=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i.info=null,i.timeCurrent=Config.TIMEOUT_RECORD,i.addEventListener(eui.UIEvent.COMPLETE,i.uiCompHandler,i),i.skinName="resultListSkin",i.info=e,i.info&&(i.dataList.itemRenderer=ResultItemRenderer,i.initList()),i}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.uiCompHandler=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.timeCurrent=Config.TIMEOUT_RECORD;var t=new egret.Timer(1e3,Config.TIMEOUT_RECORD);t.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),t.start()},e.prototype.timerFunc=function(){this.timeCurrent--,this.time.text=String(this.timeCurrent)},e.prototype.initList=function(){if(this.info){var t=new eui.VerticalLayout;t.gap=6,this.dataList.layout=t;for(var e=[],i=0;i<this.info.length;i++){var n=this.info[i];e.push(n)}this.dataList.dataProvider=new eui.ArrayCollection(e)}},e}(eui.Component);__reflect(ResultList.prototype,"ResultList");var ResultPanel=function(t){function e(e){var i=t.call(this)||this;i.accoutingData=e,i.addEventListener(eui.UIEvent.COMPLETE,i.uiCompHandler,i);for(var n,o=0;o<e.length;o++)if(e[o].uid==Config.USER_OPEN_ID){n=o;break}e&&1===e[n].status?(i.skinName="resultWinPanelSkin",i.status=!0,console.log("%cwindata","color:red",e)):(i.skinName="resultLosePanelSkin",i.status=!1,console.log("%closedata","color:red",e)),RoomUI.resultPanel&&RoomUI.resultPanel.parent.removeChild(RoomUI.resultPanel),i.tgpLight.addEventListener("complete",i.onTweenGroupComplete,i);var r=i;return setTimeout(function(){r.tgpLight.play()},100),setTimeout(function(){r.tgpMain.play()},100),i}return __extends(e,t),e.prototype.uiCompHandler=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this);var t=this.status?"huanhu":"qihong";SoundManager.playEffect(t),this.list_result=new ResultList(this.accoutingData),this.list_result.x=310,this.list_result.y=300,this.list_result.width=1300,this.list_result.height=700,this.list_result.alpha=1,this.addChildAt(this.list_result,1),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.againFunc,this),this.timer=new egret.Timer(1e3*Config.TIMEOUT_RECORD,1),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.againFunc,this),this.timer.start()},e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.onTweenGroupComplete=function(){this.tgpLight.play(0)},e.prototype.closeFunc=function(){this.parent.removeChild(this),RoomUI.getInstance().RoomRecord&&RoomUI.getInstance().ResultTrue()},e.prototype.againFunc=function(){this.timer.stop(),this.closeFunc();var t=RoomUI.getInstance();t.gameAgain(),t.showClock("prepare"),t.showControlBar("prepare")},e}(eui.Component);__reflect(ResultPanel.prototype,"ResultPanel");var roomList=function(t){function e(){var e=t.call(this)||this;return e.skinName="roomListSkin",e["goto"].addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){console.log("战绩详情"),GameController.getInstance().C_SEND_XIANGQING(e.id,1),recentRecord._instance.roomid=e.id},e),e}return __extends(e,t),e.prototype.dataChanged=function(){for(var t=this.data,e=this.data.uList,i=0;i<e.length;i++)i>1&&(this["group_"+i].getElementAt(0).$visible=!0),this["group_"+i].getElementAt(1).text=e[i].nickname,this["group_"+i].getElementAt(2).text=e[i].score,this["group_"+i].getElementAt(2).textColor="-"==e[i].score[0]?6519295:16756268;this.id=t.id,this.num.text=t.rid,this.date.text=Utils.timeToDate(t.time),this.mode.text=["","抢庄","轮庄","定庄"][parseInt(t.model)],this.dizhu.text=String(t.bet)},e}(eui.ItemRenderer);__reflect(roomList.prototype,"roomList");var animation=function(){function t(){}return t.tweenCoin=function(e,i){t.finishData=e,t.playersList=i;var n,o,r=e,s=[],a=[],l=[];console.log("tweenCoin ==== ",e,i);for(var h=0;h<i.length;h++)if(i[h])for(var c=0;c<r.length;c++)if(String(r[c].uid)==String(i[h].data.uid)){0==h?(console.log("是庄家"),n=i[h],o=h,l=SeatManager.getInstance().getCoinPos(i[h].data.pos)):(console.log("不是庄家",r[c].score),r[c].score>0?s.push(SeatManager.getInstance().getCoinPos(i[h].data.pos).concat([h]).concat(["+"+parseInt(r[c].score)])):r[c].score<0&&a.push(SeatManager.getInstance().getCoinPos(i[h].data.pos).concat([h]).concat([""+parseInt(r[c].score)])));break}var u=0;a.length&&(setTimeout(function(){SoundManager.playEffect("bet")},600),setTimeout(function(){for(var e=0,i=0;i<a.length;i++){t.tweenCoinSingle(a[i],l);var n=Utils.formatScoreForRead(a[i][3]);t.showScoreTips(a[i][2],n),e+=Number(a[i][3])}var r=Utils.formatScoreForRead((0-e).toString());t.showScoreTips(o,"+"+r)},0),u=1500),s.length&&(setTimeout(function(){SoundManager.playEffect("bet")},600+u),setTimeout(function(){for(var e=0,i=0;i<s.length;i++){t.tweenCoinSingle(l,s[i]);var n=Utils.formatScoreForRead(s[i][3]);t.showScoreTips(s[i][2],"+"+n),e+=parseInt(s[i][3])}var r=Utils.formatScoreForRead(String(0-e));t.showScoreTips(o,r)},u)),t.updatePlayerScore(e)},t.tweenCoinSingle=function(e,i){for(var n=20,o=[],r=1;n>=r;r+=1){o[r]=t.createCoin(),o[r].x=e[0],o[r].y=e[1],o[r].scaleX=2,o[r].scaleY=2,o[r].pos_from_x=e[0]+Utils.rand(-40,40),o[r].pos_from_y=e[1]+Utils.rand(-40,40),RoomUI.getInstance().addChild(o[r]),egret.Tween.get(o[r]).to({x:o[r].pos_from_x,y:o[r].pos_from_y},400,egret.Ease.circInOut)}for(var r=1;n>=r;r+=1){o[r].x=o[r].pos_from_x,o[r].y=o[r].pos_from_y,egret.Tween.get(o[r]).wait(500+500*r/n).to({x:i[0],y:i[1]},500,egret.Ease.circInOut).call(t.cleanAtTweenEnd,this,[o[r]])}},t.createCoin=function(){var t;return this.coinPool||(this.coinPool=[]),t=this.coinPool.length?this.coinPool.shift():this.createImageByName("v2_icon_coin")},t.showScoreTips=function(e,i){this.resetScoreTips(e),t.gp_score[e].y+=60,i=String(i);var n="-"==i[0]?"b":"y",o=[];o.push(this.createImage()),"-"==i[0]?o[0].source="num_"+n+"_minus":"+"==i[0]&&(o[0].source="num_"+n+"_plus");for(var r=1;r<i.length;r++)o.push(this.createImage()),"."==i[r]?o[r].source="num_"+n+"_dot":"万"==i[r]?o[r].source="num_"+n+"_wan":o[r].source="num_"+n+"_"+i[r];for(var r=0;r<o.length;r++)o[r].x=28*r,t.gp_score[e].addChildAt(o[r],r+1);var s=this.createImage();s.source="num_"+n+"_bg",s.horizontalCenter=0,s.verticalCenter=0,s.width=28*o.length+40,s.height=42,t.gp_score[e].addChildAt(s,0),t.gp_score[e].width=s.width,t.gp_score[e].height=s.height,t.gp_score[e].scaleX=1.6,t.gp_score[e].scaleY=1.6,t.gp_score[e].visible=!0,t.mask_score.visible=!0;var a=this;this.tweenRunningTotal++,egret.Tween.get(t.gp_score[e]).to({y:t.gp_score[e].y-60},5e3,egret.Ease.circOut).call(function(){for(var t=0;t<o.length;t++)a.deleteImage(o[t]);a.resetScoreTips(e),a.tweenRunningTotal--,this.tweenEnd()})},t.updatePlayerScore=function(e){for(var i=e,n=t.playersList.length,o=i.length,r=0;n>r;++r)for(var s=t.playersList[r],a=0;o>a;++a)s&&s.getOpenId()==i[a].uid&&s.updateScore(i[a].score)},t.cleanAtTweenEnd=function(t){t&&t.parent&&t.parent.removeChild(t),this.deleteCoin(t)},t.createImageByName=function(t){var e=new eui.Image,i=RES.getRes(t);return e.texture=i,e},t.resetScoreTips=function(e){var i=t.gp_score[e];i&&(i.visible=!1,i.removeChildren())},t.createImage=function(){var t;return this.imagePool||(this.imagePool=[]),t=this.imagePool.length?this.imagePool.shift():new eui.Image},t.deleteImage=function(t){this.imagePool||(this.imagePool=[]),this.imagePool.push(t)},t.deleteCoin=function(t){this.coinPool||(this.coinPool=[]),this.coinPool.push(t)},t}();animation.tweenRunningTotal=0,__reflect(animation.prototype,"animation");var PokerMin=function(t){function e(e){var i=t.call(this)||this;return i.pokerData=e,i.addEventListener(eui.UIEvent.COMPLETE,i.uiCompHandler,i),i.skinName="pokerMinSkin",i}return __extends(e,t),e.prototype.uiCompHandler=function(){this.initPoker()},e.prototype.initPoker=function(){var t=this.getValueStr(),e=this.getSuitStrArr();this.number.source=t,this.pokerData&&(this.pokerData.n<=10?(this.suitX.visible=!0,this.suitX.source=e[1]):(this.suitF.visible=!0,this.suitF.source=e[1]))},e.prototype.getValueStr=function(){var t="",e="",i=this.pokerData;return i&&(2==i.suit||4==i.suit?t="red_":(1==i.suit||3==i.suit)&&(t="black_"),e=t+i.n),e},e.prototype.getSuitStrArr=function(){var t="",e="",i="",n="",o=[],r=this.pokerData;if(r){switch(parseInt(r.suit)){case 1:t="diamond_";break;case 2:t="heart_";break;case 3:t="club_";break;case 4:t="spade_"}switch(e=t+"s",o.push(e),parseInt(r.n)){case 11:n=t+"jack",o.push(n);break;case 12:n=t+"queen",o.push(n);break;case 13:n=t+"king",o.push(n);break;default:i=t+"x",o.push(i)}}return o},e}(eui.Component);__reflect(PokerMin.prototype,"PokerMin");